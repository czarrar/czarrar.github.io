---
layout: post
title: "Monday"
date: 2013-11-04 12:20
comments: true
categories: [nilearn, abide, quickpack]
toc: true
---

# NiLearn Test Data

Note that the code to generate all this is as well as the actual package is in `/home/data/Projects/CPAC_Regression_Test/2013-10-04_v0-3-2/run/gael-o/package`.

I've already gotten the subject data and regressors. I am left to create the group phenotypic file. It appears that I don't need to duplicate the previous setup so I can use what we have on motion per subject. With this new data packaged up, I uploaded it to my connectir repository as I still don't have access to the ADHD200 repository.

The download links are below:

http://connectir.projects.nitrc.org/adhd40_p1.nii.gz
http://connectir.projects.nitrc.org/adhd40_p2.nii.gz
http://connectir.projects.nitrc.org/adhd40_p3.nii.gz
http://connectir.projects.nitrc.org/adhd40_p4.nii.gz

And I have contacted the other peeps about this. So DONE.

---

# ABIDE Preprocessing

I found out that the QC pages are a little broken. So this will have to wait.

## Run Config Setup

I have adjusted this file to run one subject for every two nodes. I am using FSL5 now. Preprocessing will be run as well as all the derivatives except centrality (degree or eigen). This is because they both need a decent amount of RAM and computational time so I'll wait to run them separately later.

---

# QuickPack

So the first general issue that I'm experiencing is that if I run everything (no quick-pack), then I don't get any of the sym links. However, in my Emotional-BS run, the symlinks all seem to be fine! A little weird. I'm not sure what is causing the problem.

## Running with just CPAC

I'm focusing on why I'm getting symlink issues when I run internally with CPAC. I think the reasons that no files are being symlinked is because there might be single quotes in the strategy part of the path.

``` bash
ln -s /home2/data/Projects/ABIDE_Initiative/CPAC/test_qp/All_Output/pipeline_RameyBorough/0051466_session_1/qc/mni_normalized_anatomical_a/mni_anat_a.png /home2/data/Projects/ABIDE_Initiative/CPAC/test_qp/All_Output/sym_links/pipeline_RameyBorough/_compcor_'ncomponents_5_linear1.global1.motion1.quadratic1.compcor1.csf0'_CSF_0.96_GM_0.7_WM_0.96/0051466_session_1/scan/qc/mni_anat_a.png
```

If I run this command that was spit out from CPAC, then I get a "No such file or directory" error. This error doesn't appear with CPAC but this might explain why no symlinks were generated.

Now we must understand why those single quotes are there. We should note that there were actually 2 strategies that I had given but only one strategy folder in the symlinks directory folder was created. I wonder if this has to do with some error?

I tried to open the config file with the GUI and re-save it, seeing if that would help but it didn't. Now I'll try to run the pipeline from the GUI. Yup that fixed the issue and it isn't related to the fact that I'm using Dan's path and shiz. Running this one subject through the GUI.

## Running ALFF

There was one previous and confusing link issue. However, another issue that I didn't notice was the ALFF output directory using single quotes in its symlinks strategy directory and only has one of the two strategies. This suggests a potential benefit in running this through the GUI.

### GUI

This run failed. The error message is below. I am not sure what's going on.

```
Invalid Connection: ALFF: 0  resource_pool:  {}
Process Process-3:
Traceback (most recent call last):
  File "/home2/dlurie/Canopy/appdata/canopy-1.0.3.1262.rh5-x86_64/lib/python2.7/multiprocessing/process.py", line 258, in _bootstrap
    self.run()
  File "/home2/dlurie/Canopy/appdata/canopy-1.0.3.1262.rh5-x86_64/lib/python2.7/multiprocessing/process.py", line 114, in run
    self._target(*self._args, **self._kwargs)
  File "/home2/dlurie/Enthought/Canopy_64bit/User/lib/python2.7/site-packages/CPAC/pipeline/cpac_pipeline.py", line 1198, in prep_workflow
    alff, 'inputspec.rest_res')
  File "/home2/dlurie/Enthought/Canopy_64bit/User/lib/python2.7/site-packages/nipype/pipeline/engine.py", line 306, in connect
    self._check_nodes(newnodes)
  File "/home2/dlurie/Enthought/Canopy_64bit/User/lib/python2.7/site-packages/nipype/pipeline/engine.py", line 769, in _check_nodes
    if node.name in node_names:
AttributeError: 'NoneType' object has no attribute 'name'
```

### CLI

The error on the command-line is driven in part by two correction strategies (with and without global). Since my quick pack, can't really do both of those strategies at once anyway, why not just have one strategy specified. Trying this with ALFF and that didn't work! Ugh so it's specifically related to the command-line, which is doing something differently than the GUI.

---

# Emotional-BS

The preprocessing is done but the QC pages were not generated due to some issue in CPAC. I wish there was some way of running the QC scripts with the current outputs without me having to re-run all of CPAC. Since I ran via gelert using the `/tmp` directory, it will also need to redo all the processing.

---

# Random

I spent a bit of time getting the table of contents to work on these pages. Hopefully it was worth it (I might want to also add a go back to the top link for each header). At the very least it gives a sort-of summary list of what will be on the post.

I think I also had a bit of trouble keeping on track today. It was very frustrating and I'm hoping it was just re-adjusting to coming back to work after a brief break.

---

# TODO

```
[x] NiLearn Test Data
	[x] Generate group phenotype file
[] ABIDE Preprocessing
	[x] Email Cam about next steps
	[x] Setup the pipeline with gelert excluding centrality
	[] Start running the pipeline
[] QuickPack
	[x] Check that complete run was good
	[x] Try to figure out why the old runs did fine?
	[] Using the new complete run as input for QP
```