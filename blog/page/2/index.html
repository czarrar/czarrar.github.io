
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Zarrar's Journaling</title>
  <meta name="author" content="Zarrar Shehzad">

  
  <meta name="description" content="I should check the data that I am plotted. Right now, I am examining the mean -log10p value of the MDMR results but I think I might want to look at &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://czarrar.github.io/blog/page/2/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Zarrar's Journaling" type="application/atom+xml">
  <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <div id="logo">
  	<div id="logoLeft">{</div>
  	<div id="logoText">mob</div>
  	<div id="logoRight">}</div>
  	<div class="clear"></div>
  </div>
  <h1><a href="/">Zarrar's Journaling</a></h1>
  
    <h2>To the edge and beyond</h2>
  
  <div class="clear"></div>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:czarrar.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2013/12/01/cwas-simulations/">CWAS Simulations</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2013-12-01T21:01:00-05:00" pubdate data-updated="true">Dec 1<span>st</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I should check the data that I am plotted. Right now, I am examining the mean -log10p value of the MDMR results but I think I might want to look at the percent of significant results with each effect size. Should double check.</p>

<p>The code for the simulation analysis is located in <code>/home/data/Projects/CWAS/share/simulations</code>. I have added multiprocessing functionality to speed up the ability to go through the different parameters and iterations.</p>

<p>I have started running one iteration of things including both variables of interest. Holy crap, it finished in like 30mins, super quick. I saved the values in an rda file within the same folder. The contents of that rda are as follows:</p>

<ul>
  <li>logp.cov1</li>
  <li>fstat.cov1</li>
  <li>logp.cov0</li>
  <li>fstat.cov0</li>
</ul>

<p>The <code>cov1</code> term means that the covariate was modeled whereas <code>cov0</code> means the covariate wasn’t modeled. For <code>cov1</code> matrices, the dimensions were 2 terms x 11 group difference x 11 correlation. For <code>cov0</code> matrices, the dimensions were 11 group difference x 11 correlation (only for the group difference term). The correlation was between the age covariate and the response.</p>

<h2 id="plot">Plot</h2>

<p>I generated plots of the results on my computer using the <code>.../pro42/scripts2add/simulations/20_plot.R</code> script. Since I used Rnotebook, I was able to publish those results online at http://rpubs.com/czarrar/cwas_simulations.</p>

<h2 id="status">Status</h2>

<p>So I had to rerun the analyses since I should have been calculating power as percent of significant iterations (p &lt; 05). I upped the number of iterations to 20, hopefully this is enough.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2013/11/30/week-49-sunday/">Week 49 - Sunday</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2013-11-30T21:47:00-05:00" pubdate data-updated="true">Nov 30<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This is a bit of a cheat since I started this on Saturday (week 48).</p>

<h2 id="todo">TODO</h2>

<p>I’m trying to use the workflow for this.</p>

<h2 id="comparing-distances">Comparing Distances</h2>

<p>I was able to finish making the figure as well as the text for the paper. I added all this information to the response letter.</p>

<h2 id="simulations">Simulations</h2>

<p>I ran this and need to double check. However, I do think that something went wrong here. I need to double check the code and spot check the effect sizes given. </p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2013/11/30/plotting-images-in-r/">Plotting Images in R</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2013-11-30T19:37:00-05:00" pubdate data-updated="true">Nov 30<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Plotting images or 2D graphs are fairly easy in R. You can use the <code>image</code> function or for a nice legend, you can also use the <code>image.plot</code> function in the <code>fields</code> package. The issue I encountered for the <code>image.plot</code> function is when I want the labels from my x and y axis to be different due to a log transformation. This was not possible.</p>

<p>To get around this issue, I adapted the <code>image.plot</code> function as <code>image.zplot</code> and added the following lines that are run right after the image is generated.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="kr">if</span> <span class="p">(</span><span class="o">!</span>is.null<span class="p">(</span>axis.x<span class="p">))</span> <span class="p">{</span>
</span><span class="line">  axis.x<span class="o">$</span>side <span class="o">&lt;-</span> <span class="m">1</span>
</span><span class="line">  do.call<span class="p">(</span><span class="s">&quot;axis&quot;</span><span class="p">,</span> axis.x<span class="p">)</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line"><span class="kr">if</span> <span class="p">(</span><span class="o">!</span>is.null<span class="p">(</span>axis.y<span class="p">))</span> <span class="p">{</span>
</span><span class="line">  axis.y<span class="o">$</span>side <span class="o">&lt;-</span> <span class="m">2</span>
</span><span class="line">  do.call<span class="p">(</span><span class="s">&quot;axis&quot;</span><span class="p">,</span> axis.y<span class="p">)</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">box<span class="p">()</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>This also adds the <code>axis.x</code> and <code>axis.y</code> options, which are options with list as the argument. The list entries are the key/value pairs when calling the particular axis function. This means I can use my custom log transformed x and y axis but provide the original numbers.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2013/11/27/wednesday-week-48/">Wednesday - Week 48</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2013-11-27T11:42:00-05:00" pubdate data-updated="true">Nov 27<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2 id="summary">Summary</h2>

<p>I was able to get through at least at a partial level through the items in my TOOD list below. More details are of course below.</p>

<ul>
  <li>I checked the CPAC output and found that 1 subject had some missing preprocessing data due to a crash during nuisance. I am rerunning this subject on rocky so I can examine the working directory (it said a tissue prior was missing in the error). Everything else is good. It should be noted that there are 2 participants in OHSU that are missing the 1st scan but have 2 other scans.</li>
  <li>I reran the QC and the output pages now seem good. Need to decide the procedure for QC now.</li>
  <li>Looked into eigenvector centrality speedup. There is code to do the power iteration approach that is advocated in the Brain Connectivity paper with 1000x speedup in a fast eigenvector centrality approach. Could also email the people from that paper to ask for their code.</li>
  <li>Discussed updating VMHC to have Cameron’s fixes (register regular MNI brain to symmetric MNI brain) with Steve. Also, discussed having the registration step be done in the assigned standard anatomical resolution and then apply the warp from this registration to the native functional image into the assigned standard functional resolution. This is not currently done.</li>
  <li>Did tagging for about 30 minutes.</li>
  <li>Created TODO items for ABIDE.</li>
</ul>

<h2 id="plans">Plans</h2>

<ul>
  <li>ABIDE
    <ul>
      <li>Create TODOs</li>
      <li>Finish checking CPAC output</li>
      <li>Fix QC pages</li>
      <li>Look into fixing VMHC error when running at 3mm</li>
      <li>Look into eigenvector centrality</li>
      <li>Create quick packs for CPAC and Xinian</li>
    </ul>
  </li>
  <li>Do 1 hour of tagging</li>
</ul>

<h2 id="abide---todo">ABIDE - TODO</h2>

<p>This is a partial list and the next time I will need to make a more thorough list.</p>

<ul>
  <li>Do QC</li>
  <li>Check all outputs there for Pierre, Xinian, Chao-Gan</li>
  <li>Optimize the eigenvector centrality</li>
  <li>Make sure VMHC works properly when using 3mm output resolution</li>
  <li>Setup Quick Packs</li>
  <li>Run Quick Packs</li>
</ul>

<h2 id="abide---check-outputs">ABIDE - Check Outputs</h2>

<p>I made a script <code>20_check_subjects.R</code> in <code>.../config/24_check</code> that checks which subject is missing some preprocessing output given that the raw data exists.</p>

<p>For two subjects, we are missing the first rest scan. These subjects are from OHSU and are <code>0050155</code> and <code>0050165</code>.</p>

<p>We need to redo <code>0051275</code> since there was a failure in calculating the nuisance regression. I ran this subject again on rocky with the relevant info/scripts in <code>/data/Projects/ABIDE_Initiative/CPAC/abide/config/26_reprocess_3mm</code>.</p>

<h2 id="abide---qc">ABIDE - QC</h2>

<p>Simply rerunning the QC resolved some broken links and the QC pages appear fine. Need to set some system of getting through all these QC pages and confirm the protocol for checking.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">import</span> <span class="nn">CPAC</span>
</span><span class="line"><span class="n">CPAC</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">create_all_qc</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s">&#39;/path/to/output_directory&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="vmhc">VMHC</h2>

<p>Currently there is a bit of an issue when we try to run VMHC at 3mm. Although it now works, the registration appears to to be done at that resolution (3mm). Talking to Steve, it seems a fix proposed by Cameron would resolve my issue as well. That is, the registration between the regular MNI to the symmetric MNI would be done in the anatomical resolution, which is usually specified at 1mm. Then, this warp would be combined with the previous one to standard space, and we would apply this warp to the functional in order to get to the specified standard functional space, which is in 3mm.</p>

<h2 id="eigen-vector-centrality">Eigen-Vector Centrality</h2>

<p>I did a brief search of faster implementations of eigenvector centrality, which is also sometimes referred to as google’s page rank.</p>

<h3 id="paper-with-fast-implementation">Paper with Fast Implementation</h3>

<p>The most relevant item is a paper recommended by Cameron: http://online.liebertpub.com.ezproxy.med.nyu.edu/doi/full/10.1089/brain.2012.0087. It appears their analyses were done in matlab so if we could also get their code, it would be fairly easy to integrate with CPAC. Below is a quote from the paper that indicates this approach is very fast, potentially faster than degree centrality! Note that they used a voxel size of 2mm.</p>

<blockquote>
  <p>The RS-fMRI data of each subject contain 195,704 in-brain voxels per volume and the time-series length is 200. The approximate gain in efficiency compared to the standard algorithm is a factor 1000. The computation times for ECM of the fMRI (excluding file I/O) are 39 sec on average (std. dev. 14 sec) on an Intel Xeon.</p>
</blockquote>

<p>So figure out if we should contact them or not?</p>

<h3 id="related-links">Related Links</h3>

<p>The above paper used the power iteration method to calculate the dominant eigenvector. I found various links on the code to run this power iteration method.</p>

<ul>
  <li>Some slides with well explained code. http://homepages.math.uic.edu/~jan/mcs507/numpyveclinalg.pdf</li>
  <li>Easy to follow function although needs to be fixed: https://github.com/seckcoder/mmd/blob/9aba8a224c69daebc6f3f800e3847362911f2225/dimension_reduction.py</li>
  <li>Super straightforward code: http://stackoverflow.com/questions/13739186/compute-eigenvector-using-a-dominant-eigenvalue</li>
  <li>4 ways to compute: http://glowingpython.blogspot.com/2011/05/four-ways-to-compute-google-pagerank.html</li>
</ul>

<h2 id="tagging">Tagging</h2>

<p>I think I should go through and check the first 45 that I did. I believe that I may not have properly added the type of connectivity (seed-based, unsupervised, etc) properly.</p>

<p>Sent out an email with some issues/guidance on tagging.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2013/11/26/tuesday-week-48/">Tuesday - Week 48</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2013-11-26T10:41:00-05:00" pubdate data-updated="true">Nov 26<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2 id="summary">Summary</h2>

<p>I was able to get through a fair amount of what I planned (next section). Here is what I did do:</p>

<ul>
  <li>Finished updating centrality code to be memory efficient</li>
  <li>Created a command-line tool to run said centrality code</li>
  <li>Ran memory test on final centrality code. The memory limit that a user sets is roughly (within 50MB) the amount that is actually used.</li>
  <li>Found path to Yang’s QC report for ABIDE</li>
  <li>Finished writing script to check what CPAC outputs exist. Most of the data appear to have been written with only a few missing data.</li>
</ul>

<h2 id="plans">Plans</h2>

<ul>
  <li>Do final memory test for centrality code</li>
  <li>Create command-line centrality wrapper</li>
  <li>Finish 10mins (from yesterday) for CMI librarian tagging</li>
  <li>Find Yang’s old QCing and related PDF</li>
  <li>Get details on ABIDE preprocessing output (what completed and what didn’t)</li>
  <li>Start creating quick packs for different strategies (CPAC, Pierre, Xinian, and Chao-Gan).</li>
</ul>

<h3 id="questions">Questions</h3>

<ul>
  <li>How will quick pack work for Pierre’s data? Do we provide the identity matrix?</li>
</ul>

<h2 id="abide-processing-output">ABIDE Processing Output</h2>

<p>One thing to check is if all scans have been preprocessed (i.e., if a subject has 3 scans as is the case with OHSU). I could check to see what other’s have done. Hmm not a bad idea. First find subjects with more than one scan and then see what happens with these subjects. Yes, the OHSU data has more than 1 scan per participant (can be up to 3 scans). Our CPAC processing did produce output for all scans. Ok so Xinian and I think Chao-Gan did not actually preprocess the additional scans, but Pierre did. Also Xinian and Chao-Gan did not concatenate their data for those subjects as the number of time-points was the same.</p>

<p>I also finished creating a script that checks on the filtered and globally corrected data.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">df <span class="o">&lt;-</span> read.csv<span class="p">(</span><span class="s">&quot;zcheck_exists_filt_global.csv&quot;</span><span class="p">)</span>
</span><span class="line">rownames<span class="p">(</span>df<span class="p">)</span> <span class="o">&lt;-</span> df<span class="o">$</span>X
</span><span class="line">df <span class="o">&lt;-</span> df<span class="p">[,</span><span class="m">-1</span><span class="p">]</span>
</span><span class="line">nrow<span class="p">(</span>df<span class="p">)</span> <span class="o">-</span> colSums<span class="p">(</span>df<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Here is the output below. We can see that we have most of the data but there are a couple of bad (possibly very bad) subject data.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">                         alff                  anatomical_brain
</span><span class="line">                            <span class="m">3</span>                                 <span class="m">0</span>
</span><span class="line">          anatomical_reorient   anatomical_to_mni_nonlinear_xfm
</span><span class="line">                            <span class="m">0</span>                                 <span class="m">0</span>
</span><span class="line">              ants_affine_xfm                                dr
</span><span class="line">                            <span class="m">0</span>                                 <span class="m">3</span>
</span><span class="line">                        falff             functional_brain_mask
</span><span class="line">                            <span class="m">3</span>                                 <span class="m">2</span>
</span><span class="line">functional_brain_mask_to_standard          functional_freq_filtered
</span><span class="line">                            <span class="m">2</span>                                 <span class="m">3</span>
</span><span class="line">               functional_mni     functional_nuisance_residuals
</span><span class="line">                            <span class="m">3</span>                                 <span class="m">3</span>
</span><span class="line">functional_to_anat_linear_xfm                   mean_functional
</span><span class="line">                            <span class="m">2</span>                                 <span class="m">2</span>
</span><span class="line">    mni_normalized_anatomical                      preprocessed
</span><span class="line">                            <span class="m">0</span>                                 <span class="m">2</span>
</span><span class="line">                         reho
</span><span class="line">                            <span class="m">3</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="abide-qc">ABIDE QC</h2>

<p>I was able to find Yang’s QC report in <code>/data/Projects/ABIDE_Initiative/CPAC/QC</code>.</p>

<p>Didn’t get a chance to regenerate the QC outputs but I think I might want to do this after I resolve that all the subject’s have data output with CPAC.</p>

<h2 id="centrality">Centrality</h2>

<p>Details for the military tactics taken to resolving the memory overage issues in the centrality, see <a href="/blog/2013/11/25/updating-centrality">this page</a>.</p>

<h3 id="memory-test">Memory Test</h3>

<p>Below are the results of running <code>./memtopX ./x_test_memprof.py</code> in <code>.../config/test_quick_pack</code>. I set a 1GB memory limit here, which led to two blocks being used. It seems further down that it came close to the this limit with 1.05GB being used.</p>

<p>Note that I’ve used 4mm data in standard space here, although later I also test with similar results using 3mm data.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">sorted nodes <span class="p">[</span><span class="m">0.0</span><span class="p">,</span> <span class="m">1.0</span><span class="p">]</span>
</span><span class="line">threshold_option <span class="o">--&gt;</span> <span class="m">0</span>
</span><span class="line">p_value <span class="o">-&gt;</span> <span class="m">0.266037302736</span>
</span><span class="line">r_value <span class="o">--&gt;</span>  <span class="m">0.0913878943802</span>
</span><span class="line">inside optimized_centraltity<span class="p">,</span> r_value <span class="o">-&gt;</span> <span class="m">0.0913878943802</span>
</span><span class="line">block_size <span class="o">-&gt;</span>  <span class="m">14236</span>
</span><span class="line">Setup Degree Output
</span><span class="line">Normalize TimeSeries
</span><span class="line">Computing centrality across <span class="m">18091</span> voxels
</span><span class="line">running block <span class="o">-&gt;</span> <span class="m">14236</span> <span class="m">0</span>
</span><span class="line">...correlating
</span><span class="line">...calculating degree
</span><span class="line">...removing correlation matrix
</span><span class="line">running block <span class="o">-&gt;</span> <span class="m">18091</span> <span class="m">14236</span>
</span><span class="line">...correlating
</span><span class="line">...calculating degree
</span><span class="line">...removing correlation matrix
</span><span class="line">timing<span class="o">:</span> <span class="m">32.47</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Here is the corresponding output of <code>mem.log</code> that recorded the memory usage for my script every 30 seconds.</p>

<p>File /Users/zarrar/Dropbox/Journal/octopress/source/downloads/code/cpac_centrality_memory.log could not be found</p>

<p>With the 3mm data, I set a memory limit of 4GB at first. This leads to a maximum usage of 4.03GB in the first block (it’s lower in the next block). Pretty nice! If I set a memory limit instead of 1GB, then I get a maximum usage of 1.03GB (consistent in most blocks). Score.</p>

<h3 id="command-line-tool">Command-Line Tool</h3>

<p>To make it easier to directly call the centrality code, I created a command-line interface. This is in <code>C-PAC/tools</code> and the script is called <code>cpac_centrality.py</code>. The auto-generated help is shown below.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">usage<span class="o">:</span> cpac_centrality.py <span class="p">[</span><span class="o">-</span>h<span class="p">]</span> <span class="o">-</span>i INPUT <span class="p">[</span><span class="o">-</span>m MASK<span class="p">]</span> <span class="p">[</span><span class="o">--</span>degree<span class="p">]</span> <span class="p">[</span><span class="o">--</span>eigen<span class="p">]</span>
</span><span class="line">                          <span class="p">[</span><span class="o">--</span>binarize<span class="p">]</span> <span class="p">[</span><span class="o">--</span>weighted<span class="p">]</span> <span class="p">[</span><span class="o">--</span>sparsity SPARSITY<span class="p">]</span>
</span><span class="line">                          <span class="p">[</span><span class="o">--</span>pvalue PVALUE<span class="p">]</span> <span class="p">[</span><span class="o">--</span>rho RHO<span class="p">]</span> <span class="p">[</span><span class="o">--</span>memlimit MEMLIMIT<span class="p">]</span>
</span><span class="line">                          <span class="p">[</span><span class="o">-</span>o OUTDIR<span class="p">]</span>
</span><span class="line">
</span><span class="line">Compute centrality <span class="kr">for</span> a given timeseries.
</span><span class="line">
</span><span class="line">optional arguments<span class="o">:</span>
</span><span class="line">  <span class="o">-</span>h<span class="p">,</span> <span class="o">--</span>help            show this help message and exit
</span><span class="line">  <span class="o">-</span>i INPUT<span class="p">,</span> <span class="o">--</span>input INPUT
</span><span class="line">                        Input timeseries data file
</span><span class="line">  <span class="o">-</span>m MASK<span class="p">,</span> <span class="o">--</span>mask MASK  Brain mask <span class="p">(</span>by default the program will create a mask
</span><span class="line">                        where voxels have non<span class="o">-</span>zero variance regardeless of the
</span><span class="line">                        user specified mask<span class="p">)</span>.
</span><span class="line">  <span class="o">--</span>degree              Calculate degree centrality
</span><span class="line">  <span class="o">--</span>eigen               Calculate eigen centrality
</span><span class="line">  <span class="o">--</span>binarize            For a given voxel<span class="p">,</span> save the number of connections that
</span><span class="line">                        pass a threshold
</span><span class="line">  <span class="o">--</span>weighted            For a given voxel<span class="p">,</span> save the sum of all connection
</span><span class="line">                        weights that pass a threshold.
</span><span class="line">  <span class="o">--</span>sparsity SPARSITY   Sparsity based threshold. <span class="p">(</span>Only one threshold option
</span><span class="line">                        can be specified.<span class="p">)</span>
</span><span class="line">  <span class="o">--</span>pvalue PVALUE       P<span class="o">-</span>value threshold <span class="kr">for</span> each connection. <span class="p">(</span>Only one
</span><span class="line">                        threshold option can be specified.<span class="p">)</span>
</span><span class="line">  <span class="o">--</span>rho RHO             Regular correlation threshold. <span class="p">(</span>Only one threshold
</span><span class="line">                        option can be specified.<span class="p">)</span>
</span><span class="line">  <span class="o">--</span>memlimit MEMLIMIT   Memory limit that should be set.
</span><span class="line">  <span class="o">-</span>o OUTDIR<span class="p">,</span> <span class="o">--</span>outdir OUTDIR
</span><span class="line">                        Output directory
</span></code></pre></td></tr></table></div></figure></notextile></div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2013/11/25/updating-centrality/">Updating Centrality</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2013-11-25T10:26:00-05:00" pubdate data-updated="true">Nov 25<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I’ll go through the different changes in the CPAC centrality code that I’ve implemented.</p>

<h2 id="normalized-timeseries">Normalized Timeseries</h2>

<p>The easiest change was to use normalized time series, which then allows one to compute the crossproduct of the time series to calculate the correlations. Below are the relevant code slices that call on functions used in CWAS.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="n">timeseries</span> <span class="o">=</span> <span class="n">norm_cols</span><span class="p">(</span><span class="n">timeseries</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span class="line"><span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">timeseries</span><span class="p">[:,</span><span class="n">j</span><span class="p">:</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">timeseries</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="block-size">Block Size</h2>

<p>We changed the block size to more accurately reflect the underlying operations. Although it should be noted that numpy has some poor memory handling as certain temporary objects will still be maintained in memory throwing off this calculation. However, later sections will show attempts to rectify this issue.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="n">nvoxs</span>   <span class="o">=</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class="line"><span class="n">ntpts</span>   <span class="o">=</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span class="line"><span class="n">nbytes</span>  <span class="o">=</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">itemsize</span>
</span><span class="line">
</span><span class="line"><span class="k">if</span> <span class="n">memory_allocated</span><span class="p">:</span>
</span><span class="line">    <span class="n">memory_in_bytes</span> <span class="o">=</span> <span class="n">memory_allocated</span> <span class="o">*</span> <span class="mf">1024.0</span><span class="o">**</span><span class="mi">3</span>    <span class="c"># assume it is in GB</span>
</span><span class="line">    <span class="n">block_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">memory_in_bytes</span><span class="o">/</span><span class="p">(</span><span class="n">nvoxs</span> <span class="o">*</span> <span class="n">nbytes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">ntpts</span><span class="o">*</span><span class="n">nbytes</span> <span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="k">if</span> <span class="n">block_size</span> <span class="o">&gt;</span> <span class="n">nvoxs</span><span class="p">:</span>
</span><span class="line">    <span class="n">block_size</span> <span class="o">=</span> <span class="n">nvoxs</span>
</span><span class="line"><span class="k">elif</span> <span class="n">block_size</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span class="line">    <span class="k">raise</span> <span class="ne">MemoryError</span><span class="p">(</span><span class="s">&quot; Not enough memory available to perform degree centrality&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Note that the calculation is also dynamic with the data type of the time series.</p>

<h2 id="no-more-nan-to-number">No More NaN to Number</h2>

<p>This function <code>np.nan_to_num</code> is applied on the correlation matrix to turn any NaNs to 0s. This will occur when a time-series is all 0s leading to an error of sorts when calculating the correlation as you will be dividing by zeros and what not. The easiest way to avoid this error is to remove any flat time-series. I do this in the <code>load</code> function that initially reads in the time-series and the mask data.</p>

<p>I create an additional mask that is specific to the data. This is then combined with the externally defined template mask for a final mask at a later step.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="n">datmask</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span class="line"><span class="n">mask</span>    <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">template</span><span class="p">)</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="more-efficient-sum-of-thresholded-correlations">More Efficient Sum of Thresholded Correlations</h2>

<p>This particular step (below) is both slow and takes up a lot of memory. For instance the <code>corr_matrix &gt; r_value</code> must create a new copy of the matrix.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">corr_matrix</span> <span class="o">&gt;</span> <span class="n">r_value</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>One solution is to use cython. For now, I will do this without compiling the whole package and use <code>pyxthon</code> that will dynamically compile the new function at runtime. Below is the cython code.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">def</span> <span class="nf">centrality_binarize_double</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">double</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">2</span><span class="p">]</span> <span class="n">cmat</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">double</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">]</span> <span class="n">cent</span><span class="p">,</span> <span class="n">double</span> <span class="n">thresh</span><span class="p">):</span>
</span><span class="line">    <span class="n">cdef</span> <span class="n">unsigned</span> <span class="nb">int</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span>
</span><span class="line">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">cmat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span class="line">        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">cmat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span class="line">            <span class="n">cent</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">cent</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="o">*</span><span class="p">(</span><span class="n">cmat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">thresh</span><span class="p">)</span>
</span><span class="line"><span class="c">#</span>
</span><span class="line"><span class="k">def</span> <span class="nf">centrality_weighted_double</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">double</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">2</span><span class="p">]</span> <span class="n">cmat</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">double</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">]</span> <span class="n">cent</span><span class="p">,</span> <span class="n">double</span> <span class="n">thresh</span><span class="p">):</span>
</span><span class="line">    <span class="n">cdef</span> <span class="n">unsigned</span> <span class="nb">int</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span>
</span><span class="line">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">cmat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span class="line">        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">cmat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span class="line">            <span class="n">cent</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">cent</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">cmat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">cmat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">thresh</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>I created a wrapper centrality function that is fairly straightforward. It allows one to access all the different C functions through one python function. I also wrote 2 tests that both passed. Here’s one example to illustrate the new functionality (<code>comp</code>) relative to the old (<code>ref</code>).</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">def</span> <span class="nf">test_centrality_binarize</span><span class="p">():</span>
</span><span class="line">    <span class="k">print</span> <span class="s">&quot;testing centrality binarize&quot;</span>
</span><span class="line">
</span><span class="line">    <span class="n">method</span>      <span class="o">=</span> <span class="s">&quot;binarize&quot;</span>
</span><span class="line">    <span class="n">nblock</span>      <span class="o">=</span> <span class="mi">20</span>
</span><span class="line">    <span class="n">nvoxs</span>       <span class="o">=</span> <span class="mi">100</span>
</span><span class="line">    <span class="n">r_value</span>     <span class="o">=</span> <span class="mf">0.2</span>
</span><span class="line">    <span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="n">nblock</span><span class="p">,</span> <span class="n">nvoxs</span><span class="p">))</span>
</span><span class="line">
</span><span class="line">    <span class="n">ref</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">corr_matrix</span><span class="o">&gt;</span><span class="n">r_value</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span class="line">    <span class="n">comp</span> <span class="o">=</span> <span class="n">centrality</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">,</span> <span class="n">r_value</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="n">assert_equal</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">comp</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="deleting-temporary-correlation-matrix">Deleting Temporary Correlation Matrix</h2>

<p>The correlation matrix created for each block loop will not be freed, hence there is a build up of these matrices in memory. A simple fix for this is to delete the correlation matrix at the end of each loop. It is then freed when the next loop iteration begins.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2013/11/25/monday-week-48/">Monday - Week 48</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2013-11-25T09:59:00-05:00" pubdate data-updated="true">Nov 25<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2 id="plans">Plans</h2>

<p>Today, I planned to work on…see summary section for what actually got done.</p>

<ul>
  <li>finish memory fixes to centrality code</li>
  <li>checking on the 3mm registration of ABIDE</li>
  <li>setup quick pack for Pierre &amp; Xinian’s data</li>
  <li>setup quick pack for ABIDE data (centrality and VMHC)</li>
</ul>

<h2 id="summary">Summary</h2>

<p>I wasn’t able to get through a lot that was planned. I worked on the following (described more later):</p>

<ul>
  <li>Centrality Coding</li>
  <li>Checking paths for ABIDE preprocessing</li>
</ul>

<h2 id="centrality-code">Centrality Code</h2>

<p>I updated the centrality code with several fixes and cleaned up some of the functions. Details of this work can be found on this <a href="/blog/2013/11/25/update-centrality">other post</a>.</p>

<h2 id="qc">QC</h2>

<p>The 3mm registration is done. I want to now take a closer look at the data. I want to take a look at a few things:</p>

<ul>
  <li>Are all the outputs there? Maybe make some type of table or record of what is good with what?</li>
  <li>Can we fix up the QC pages?</li>
  <li>Do the images look good?</li>
</ul>

<p>I began to create the code to find the needed paths in the preprocessing directory. This can be found in <code>/data/Projects/ABIDE_Initiative/CPAC/abide/config/24_check/10_check_path.py</code>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2013/11/24/timing-comparison/">Timing Comparison</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2013-11-24T15:21:00-05:00" pubdate data-updated="true">Nov 24<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2 id="overview">Overview</h2>

<p>I will be comparing the timing for the following functions:</p>

<ul>
  <li>Degree Centrality</li>
  <li>GLM</li>
  <li>MDMR</li>
  <li>SVM (linear)</li>
  <li>K-Means Clustering</li>
</ul>

<p>This order also reflects the speed result (first is faster).</p>

<h2 id="parameters">Parameters</h2>

<p>I examined the speed for examining connectivity-phenotype relationships for the following parameters:</p>

<ul>
  <li>number of nodes or connectivity maps: <strong>10</strong></li>
  <li>number of elements in each connectivity map: <strong>800</strong></li>
  <li>number of participants: <strong>100</strong></li>
  <li>number of iterations: <strong>100</strong></li>
</ul>

<p>In the case of SVM and K-Means, I did the analysis like I did with MDMR. I examined the fit between one connectivity map per participant and participant group membership. Thus, the analysis was repeated 10 times, one for each connectivity map.</p>

<p>This whole process was repeated 100 times.</p>

<h2 id="system">System</h2>

<p>The timing analysis was performed on a MacBook Pro OSX v10.8 using a 2.53GHz Intel Core 2 Duo with 4GB of RAM.</p>

<h2 id="results">Results</h2>

<p>A graph shows the average timing for each approach across 100 iterations below.</p>

<script type="text/javascript" src="https://www.google.com/jsapi"></script>

<script type="text/javascript">
  google.load("visualization", "1", {packages:["corechart"]});
  google.setOnLoadCallback(drawChart);
  function drawChart() {
    var data = google.visualization.arrayToDataTable([
      ['Method', 'Time'],
      ['Degree',  6],
      ['GLM',  		30],
      ['MDMR',  	52],
      ['SVM',  		229], 
		 ['K-Means', 788]
    ]);

    var options = {
      title: 'Average time (ms) to compute connectivity-phenotype association',
      hAxis: {title: 'Method'}, 
		 legend: {position: 'none'}
    };

    var chart = new google.visualization.ColumnChart(document.getElementById('chart_div'));
    chart.draw(data, options);
  }
</script>

<div id="chart_div" style="width: 500px; height: 300px;"></div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2013/11/24/similarity-of-iq-cwas-across-scans/">Similarity of IQ CWAS Across Scans</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2013-11-24T11:51:00-05:00" pubdate data-updated="true">Nov 24<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Get the overlap (dice) and similarity (spearman) of the IQ CWAS between scans, and estimate the significance. Below are the current results for a simple comparison.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: right">measures</th>
      <th>values</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right">dice</td>
      <td>0.2731</td>
    </tr>
    <tr>
      <td style="text-align: right">pearson</td>
      <td>0.2571</td>
    </tr>
    <tr>
      <td style="text-align: right">spearman</td>
      <td>0.2511</td>
    </tr>
    <tr>
      <td style="text-align: right">kendalls</td>
      <td>0.1695</td>
    </tr>
  </tbody>
</table>

<p>Let’s focus on just the dice and spearman for now. For a proper permutation test, I want to make sure that the permuted subject indices are the same for scan 1 and 2. This would allow one to test the hypothesis of how similar the CWAS results for IQ are between scans when given a random list of participants.</p>

<h2 id="re-running-mdmr-for-scan-2">Re-Running MDMR for Scan 2</h2>

<p>This understanding mean I need to rerun the MDMR for scan 2 using the permutation indices from scan 1. I have created a new script to run these modified MDMR analyses for scan 2.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">cd /home2/data/Projects/CWAS/share/nki/05_cwas
</span><span class="line">./30_mdmr_using_perms.bash</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="permutations-for-dice-and-spearman">Permutations for dice and spearman</h2>

<p>Now we need to take the extra time to gather p-values for everything so we can threshold and compare. I’ll use some of the false positive code <code>share/results/20_cwas_iq/40_false_positives.R</code> in getting the p-values of the permutations. The result of this inspiration can be found in <code>/home2/data/Projects/CWAS/share/figures/fig_03</code> where I created the <code>E2_compare_scans.R</code> file. This script does the following (among other things):</p>

<ol>
  <li>Read in the permuted Fstats</li>
  <li>Loop through each permutation so you can</li>
  <li>Calculate significance for both scans</li>
  <li>Compare the two scans with dice (p &lt; 0.05) and spearman</li>
  <li>Return this result and loop to #3 for the next permutation</li>
</ol>

<p>Note that I’m not clustering correcting for the dice comparison and I’m using p-values here instead of F-stats.</p>

<h2 id="results">Results</h2>

<p>Highly significant with dice = 0.2731411 (p &lt; 0.001 or p = 0.0003) and spearman rho = 0.2510524 (p &lt; 0.005 or p = 0.004).</p>

<h2 id="update-connectir">Update Connectir</h2>

<p>To do this analysis, I updated the MDMR script to accept an external permutation file. This is with the new option <code>--permfiles</code>. It accepts a list of descriptor files (comma separated) that should reflect the number of factors2perm.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2013/11/23/saturday-week-47/">Saturday - Week 47</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2013-11-23T13:54:00-05:00" pubdate data-updated="true">Nov 23<span>rd</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This page covers both Saturday and Sunday (which is technically week 48).</p>

<h2 id="todo">TODO</h2>

<ul>
  <li><strong>Permutation test for dice and spearman with IQ CWAS</strong>
    <ul>
      <li><em>DONE</em></li>
    </ul>
  </li>
  <li><strong>Compare computational time for MDMR to other approaches</strong>
    <ul>
      <li><em>DONE</em></li>
    </ul>
  </li>
  <li><strong>Bootstrap analyses</strong>
    <ul>
      <li><em>DONE</em></li>
    </ul>
  </li>
  <li><strong>Compare different distances</strong>
    <ul>
      <li><em>DONE WITH TABLES</em></li>
      <li><em>GENERATE SURFACE RESULTS</em></li>
      <li><em>WRITE TEXT FOR PAPER</em></li>
      <li><em>UPDATE RESPONSE</em></li>
    </ul>
  </li>
  <li><strong>Simulations</strong>
    <ul>
      <li><em>WRITE CODE</em></li>
      <li><em>GENERATE PLOTS</em></li>
      <li><em>ADD TO RESPONSE LETTER</em></li>
    </ul>
  </li>
  <li><strong>Results</strong>
    <ul>
      <li><em>RE-COMPUTE WHERE NEEDED</em></li>
      <li><em>ADD TO PAPER</em></li>
    </ul>
  </li>
  <li><strong>Update paper with stuff from response letter</strong>
    <ul>
      <li><em>I guess waiting for feedback on response letter</em></li>
    </ul>
  </li>
</ul>

<h2 id="similarity-of-iq-cwas-across-scans">Similarity of IQ CWAS across scans</h2>

<p>See details at <a href="/2013/11/24/similarity-of-iq-cwas-across-scans/">my other post</a>.</p>

<p>Highly significant with dice = 0.2731411 (p &lt; 0.001 or p = 0.0003) and spearman rho = 0.2510524 (p &lt; 0.005 or p = 0.004).</p>

<h2 id="computational-time">Computational Time</h2>

<p>Below is the average time (ms) across 100 iterations. MDMR is a little slower than GLM but comparable.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">   method      time
1  Degree   5.76817
2     GLM  30.12167
3    MDMR  51.73251
4     SVM 228.89548
5 K-Means 788.41195</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Further details can be found on the <a href="/2013/11/24/timing-comparison/">following post</a>.</p>

<h2 id="comparing-distances">Comparing Distances</h2>

<p>Further details can be found on the <a href="/2013/11/09/comparing-distances">following post</a>.</p>

<h2 id="simulations">Simulations</h2>

<p>Getting a late start on the simulations. </p>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/3/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    
  

<section>
  <h1>Tag Cloud</h1>
    <span id="tag-cloud"><a href='/blog/categories/abide' style='font-size: 138.1818181818182%'>abide(7)</a> <a href='/blog/categories/cmi' style='font-size: 160.0%'>cmi(11)</a> <a href='/blog/categories/cpac' style='font-size: 143.63636363636363%'>cpac(8)</a> <a href='/blog/categories/cwas' style='font-size: 154.54545454545456%'>cwas(10)</a> <a href='/blog/categories/emotional-bs' style='font-size: 110.9090909090909%'>emotional-bs(2)</a> <a href='/blog/categories/jekyll' style='font-size: 105.45454545454545%'>jekyll(1)</a> <a href='/blog/categories/mdmr' style='font-size: 105.45454545454545%'>mdmr(1)</a> <a href='/blog/categories/nilearn' style='font-size: 116.36363636363636%'>nilearn(3)</a> <a href='/blog/categories/quickpack' style='font-size: 132.72727272727272%'>quickpack(6)</a> <a href='/blog/categories/r' style='font-size: 105.45454545454545%'>r(1)</a> <a href='/blog/categories/simulations' style='font-size: 105.45454545454545%'>simulations(1)</a> <a href='/blog/categories/work' style='font-size: 105.45454545454545%'>work(1)</a> <a href='/blog/categories/writedown' style='font-size: 105.45454545454545%'>writedown(1)</a> </span>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/12/17/cpac-derivative-inputs/">CPAC Derivative Inputs</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/12/13/week-50-friday/">Week 50 - Friday</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/12/10/installing-connectir/">Installing Connectir</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/12/09/week-50-monday/">Week 50 - Monday</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/12/07/cwas-simulations/">CWAS Simulations</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/czarrar">@czarrar</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'czarrar',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>My Pinboard</h1>
  <ul id="pinboard_linkroll">Fetching linkroll&#8230;</ul>
  <p><a href="http://pinboard.in/u:czarrar">My Pinboard Bookmarks &raquo;</a></p>
</section>
<script type="text/javascript">
  var linkroll = 'pinboard_linkroll'; //id target for pinboard list
  var pinboard_user = "czarrar"; //id target for pinboard list
  var pinboard_count = 3; //id target for pinboard list
  (function(){
    var pinboardInit = document.createElement('script');
    pinboardInit.type = 'text/javascript';
    pinboardInit.async = true;
    pinboardInit.src = '/javascripts/pinboard.js';
    document.getElementsByTagName('head')[0].appendChild(pinboardInit);
  })();
</script>

<!--
    Calendar aside/plugin for octopress blogging framework.
    Copyright (C) 2012  Neeraj Kumar ( neerajpkumar@gmail.com, neerajkumar@outlook.com)

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
&#8211;>
<style>
	.highlighted-calendar-day
	{
		color : #CCC;
		font-weight : bold;
	}
	
	.calendar-header-day{
		font-weight : bold;
		color : #AAA;
		font-size : 14px;
	}
	
	.highlighted-calendar-day a
	{
		
	}
	
	.prev-link
	{
		float:left;
	}
	
	.next-link
	{
		float: right;
	}
	.calendar-day
	{
		color : #888;
		font-weight : 12px;
	}
	
	.calendar-table
	{
		width : 100%;
		
	}
	
	.calendar-table td
	{
		border-right : dotted 1px lightgrey;
		text-align : center;
	}
	
	.calendar-table td:last-child
	{
		border-right : none;
	}
	
	.calendar-table th
	{
		background-color : lightgrey;
		text-align : center;
	}
	.prevCalendarLink img
	{	
		
		width : 20px;
		height : 20px;
		border: 0px;
		float: left;
		
	}
	
	.nextCalendarLink img
	{
		
		width : 20px;
		height: 20px;
		border: 0px;
		float: right;
		
	}
</style>
<script type="text/javascript" src="/javascripts/calendar.js"></script>
<section id="calendarDiv">
	<h1>Calendar</h1>
	<span style="display:block" id="calendarSpan"></span>
	<div>
		<a href="#" class="previousMonth show"/><a href="#" class="nextMonth hide"/>
	</div>
</section>
<script type="text/javascript">
  
monthCalendar = function(id,year,month)
{
  var highlightArray = new Array();
  var hightlightLinks = new Array();
  
  highlightArray.push('12/17/2013');
  hightlightLinks.push('/blog/2013/12/17/cpac-derivative-inputs/');
  
  highlightArray.push('12/13/2013');
  hightlightLinks.push('/blog/2013/12/13/week-50-friday/');
  
  highlightArray.push('12/10/2013');
  hightlightLinks.push('/blog/2013/12/10/installing-connectir/');
  
  highlightArray.push('12/09/2013');
  hightlightLinks.push('/blog/2013/12/09/week-50-monday/');
  
  highlightArray.push('12/07/2013');
  hightlightLinks.push('/blog/2013/12/07/cwas-simulations/');
  		
  var cal = new Calendar(month,year,highlightArray,hightlightLinks);
  cal.generateHTML(id);
  var element = document.getElementById(id);
  element.innerHTML = cal.getHTML();
}
	
loadCalendar = function(){
  var now = new Date();
  var month = now.getMonth();
  var year = now.getFullYear();
  monthCalendar('calendarDiv',year,month);
}
	
	if(Array.prototype.indexOf == undefined)
	{
		 Array.prototype.indexOf = function (searchElement /*, fromIndex */ ) {
			"use strict";
			if (this == null) {
				throw new TypeError();
			}
			var t = Object(this);
			var len = t.length >>> 0;
			if (len === 0) {
				return -1;
			}
			var n = 0;
			if (arguments.length > 0) {
				n = Number(arguments[1]);
				if (n != n) { // shortcut for verifying if it's NaN
					n = 0;
				} else if (n != 0 && n != Infinity && n != -Infinity) {
					n = (n > 0 || -1) * Math.floor(Math.abs(n));
				}
			}
			if (n >= len) {
				return -1;
			}
			var k = n >= 0 ? n : Math.max(len - Math.abs(n), 0);
			for (; k < len; k++) {
				if (k in t && t[k] === searchElement) {
					return k;
				}
			}
			return -1;
		}
	}
$(document).ready(function(){
  loadCalendar();
});
</script>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Zarrar Shehzad -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
