
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Zarrar's Journaling</title>
  <meta name="author" content="Zarrar Shehzad">

  
  <meta name="description" content="ABIDE I started running the ABIDE dataset once again! I wonder if a separate post that is an aggregate of my progress would be good? I need to also &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://czarrar.github.io/blog/page/4/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Zarrar's Journaling" type="application/atom+xml">
  <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <div id="logo">
  	<div id="logoLeft">{</div>
  	<div id="logoText">mob</div>
  	<div id="logoRight">}</div>
  	<div class="clear"></div>
  </div>
  <h1><a href="/">Zarrar's Journaling</a></h1>
  
    <h2>To the edge and beyond</h2>
  
  <div class="clear"></div>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:czarrar.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2013/11/11/monday-for-veterans/">Monday for Veterans</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2013-11-11T16:26:00-05:00" pubdate data-updated="true">Nov 11<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1 id="abide">ABIDE</h1>

<p>I started running the ABIDE dataset once again! I wonder if a separate post that is an aggregate of my progress would be good? I need to also check up on the mounted data on rocky.</p>

<h2 id="pierre-preprocessed-data">Pierre Preprocessed Data</h2>

<p>There are 4 different preprocessed data types.</p>

<ol>
  <li>No GSR and low-pass filter</li>
  <li>No GSR and no low-pass filter</li>
  <li>GSR and low-pass filter</li>
  <li>GSR and no low-pass filter</li>
</ol>

<p>A json file is included with each preprocessed data. This has regressor information and time-points (which I guess are the time-points that were kept for the analysis…so there was scrubbing).</p>

<h2 id="xinian-preprocessed-data">Xinian Preprocessed Data</h2>

<p>Subjects here are labeled by their site. Data includes freesurfer information. For the functional data, I am not totally sure which of the different preprocessed outputs to use. Also will we be making use of the freesurfer registered functional output?</p>

<p>A brief overview shows the following preprocessing factors that were varied:</p>

<ul>
  <li>Temporal Filtering (guessing same way as Pierre’s)</li>
  <li>Smoothnesss (0 or 6 mm FWHM)</li>
</ul>

<p>So for this and the other preprocessed data, I will need to have a working Quick Pack.</p>

<h1 id="cpac">CPAC</h1>

<p>To help better understand why some working directories are being deleted but not others, we made a change to the file for standard output and standard error. Previously, this file held information for all participants. Here are the changes I made to running with SGE that did away with this issue:</p>

<ul>
  <li>Run each subject separately with the grid engine (instead of as a job array).</li>
  <li>Use a different standard output and error for each subject</li>
  <li>Save the list of job ids and corresponding subjects</li>
</ul>

<p>Pretty simple change but big in allowing me to figure out what’s going on. Additionally, I can manually check job ids that have completed and knowing the corresponding subjects, I could manually delete the working directories if they have not been deleted already.</p>

<h1 id="quickpack">QuickPack</h1>

<p>So where did we leave off. It appears like it will run if I use the GUI but throws an error. </p>

<h1 id="other-projects">Other Projects</h1>

<p>I’m also still looking at EmotionalBS and is there anything else?</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2013/11/09/comparing-distances/">Comparing Distances</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2013-11-09T18:02:00-05:00" pubdate data-updated="true">Nov 9<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>We want to show that the choice of your distance metric won’t substantially change your results. I’ll be using the first scan of the IQ dataset. I would like to compare the following measures:</p>

<ul>
  <li>Pearson Correlation</li>
  <li>Spearman Rank</li>
  <li>Kendall Tau</li>
  <li>Lin’s concordance correlation</li>
  <li>Euclidean distance</li>
  <li>Chebychev distance</li>
  <li>Mahalanobis distance</li>
</ul>

<p>All the measures except the last are used in the Zapala et al. (2006) <em>PNAS</em> paper, and the last measure is something used in Kriegeskorte’s work. It is essentially the mean distance between two features/vectors relative to the variance in each of them. Thus, 2 sets of points could be very close on average but have huge variability, meaning that small distance is less meaningful.</p>

<h1 id="low-level-code">Low-Level Code</h1>

<p>Most of the measures are fairly straightforward. I will add them all to the internal <code>.subdist_distance</code> function, which is called to compute the distance between the different participant connectivity maps for a given voxel. Right now, I have the pearson distance, shrinkage pearson distance, and inverse covariance distance. I added the other distance functions from my list above as additional options.</p>

<p>How do you call the different distances? Note that I have made all of these functions internal so you would call it internally (within the package) as <code>.subdist_distance</code>. However, below I will use the globally accessible <code>test_sdist</code> function that is a simple wrapper around <code>.subdist_distance</code>.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">.test_sdist<span class="p">(</span>seedMaps<span class="p">,</span> dmats<span class="p">,</span> colind<span class="p">,</span> method<span class="o">=</span><span class="s">&quot;pearson&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>As you can see, we pass a matrix of participant seed maps (voxels as rows and participants as columns), a big matrix of distances (columns as voxels and rows as the vectorized distance matrix for that voxel), the index of the voxel examined in the distances, and your method of choice.</p>

<h2 id="measures">Measures</h2>

<h3 id="pearson">Pearson</h3>

<p>I updated the connectir pearson distance C function (<code>subdist_pearson_distance</code>) to compute the transformed correlation that has euclidean properties. I should make sure to test this for confirmation.</p>

<h3 id="mahalanobis-distance">Mahalanobis Distance</h3>

<p>I borrowed code for this measure from the following two links:</p>

<p>http://stats.stackexchange.com/questions/33518/pairwise-mahalanobis-distance-in-r</p>

<p>http://stats.stackexchange.com/questions/65705/pairwise-mahalanobis-distance/66325#66325</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">library<span class="p">(</span>connectir<span class="p">)</span>
</span><span class="line">library<span class="p">(</span>corpcor<span class="p">)</span>
</span><span class="line">seedMaps <span class="o">&lt;-</span> t<span class="p">(</span>matrix<span class="p">(</span>runif<span class="p">(</span><span class="m">500</span><span class="p">,</span> min<span class="o">=</span><span class="m">0</span><span class="p">,</span> max<span class="o">=</span><span class="m">2</span><span class="p">),</span> <span class="m">100</span><span class="p">,</span> <span class="m">5</span><span class="p">))</span>
</span><span class="line"><span class="c1"># invCov &lt;- ginv(cov(seedMaps))</span>
</span><span class="line">invCov <span class="o">&lt;-</span> invcov.shrink<span class="p">(</span>seedMaps<span class="p">)</span>
</span><span class="line">SQRT <span class="o">&lt;-</span> with<span class="p">(</span>svd<span class="p">(</span>invCov<span class="p">),</span> u <span class="o">%*%</span> diag<span class="p">(</span>d<span class="o">^</span><span class="m">0.5</span><span class="p">)</span> <span class="o">%*%</span> t<span class="p">(</span>v<span class="p">))</span>
</span><span class="line">dmat <span class="o">&lt;-</span> as.matrix<span class="p">(</span>dist<span class="p">(</span>seedMaps <span class="o">%*%</span> SQRT<span class="p">))</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Note that here I am using a shrinkage method to deal with the ill-posed problem of inverting a n « p issue. So far it normally fails if I take the traditional approach.</p>

<h3 id="concordance">Concordance</h3>

<p>I took the implementation in the <code>epiR</code> package and made it more suitable for a matrix approach (e.g., correlated everything with everything else). Note that the results using this alternative matrix-based approach are very close to using the epiR function but not exact. Should investigate in the future.</p>

<h3 id="others">Others</h3>

<p>Here’s some example code from the spearman distance. For the most part, I tried to use the currently available functions.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">.distance_spearman <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>seedMaps<span class="p">,</span> dmats<span class="p">,</span> colind<span class="p">,</span> transpose<span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="kc">...</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">    seedMaps <span class="o">&lt;-</span> ifelse<span class="p">(</span>transpose<span class="p">,</span> t<span class="p">(</span>seedMaps<span class="p">[,]),</span> seedMaps<span class="p">[,])</span>
</span><span class="line">    smat <span class="o">&lt;-</span> cor<span class="p">(</span>seedMaps<span class="p">,</span> method<span class="o">=</span><span class="s">&quot;spearman&quot;</span><span class="p">)</span>
</span><span class="line">    dmat <span class="o">&lt;-</span> sqrt<span class="p">(</span><span class="m">2</span><span class="o">*</span><span class="p">(</span><span class="m">1</span><span class="o">-</span>smat<span class="p">))</span>
</span><span class="line">    dmats<span class="p">[,</span>colind<span class="p">]</span> <span class="o">&lt;-</span> as.vector<span class="p">(</span>dmat<span class="p">)</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="issues">Issues</h2>

<p>I had an NaN error after running the first pearson distance. I realized that this error is related to the fact that the correlation can sometimes go over 1 due to precision errors. To combat this I added a tolerance level, where I adjust the correlation down by 1e-8. This should ensure that no correlation is above 1, which would lead to a negative number in the transformation and a NaN when trying to get the square root. Note that this is really only an issue for the pearson distance.</p>

<h1 id="higher-level-code">Higher-Level Code</h1>

<p>After computing the connectivity maps, I’d ideally want to have some manual code that runs all the possible distances and saves them in different file-backed distance matrices. However, this seems to be a bit hairy and would require lots of coding/testing. Main issues are with memory (i.e., holding all the distances in memory or partially in memory). Instead, I’ll take the easier but longer approach of running the distances for each method separately. To speed things up, I plan to use the 800 random ROIs.</p>

<p>The details for this code can be found in <code>10_subdist.bash</code>.</p>

<h1 id="running-the-analyses">Running the Analyses</h1>

<p>I’ve started to run the analyses. I ended up going with two separate workflows since the kendall was taking forever!</p>

<p>I will need to re-run the concordance since there was an error in the code. I should make sure to remove the following folder beforehand: <code>/home/data/Projects/CWAS/nki/cwas/short/try_distances/concordance_k0800_to_k0800</code>.</p>

<blockquote>
  <p>Below the time in parentheses represents computation time but excludes setup time (i.e., reading in distance matrix and creating the hat matrix).</p>
</blockquote>

<h2 id="finished">Finished</h2>

<ul>
  <li>Pearson (0.9 mins)</li>
  <li>Spearman (2.5 mins)</li>
  <li>Chebyshev (25 mins)</li>
  <li>Euclidean (6.8 mins)</li>
  <li>Kendall (1883.3 mins)</li>
  <li>Concordance (0.4 mins)</li>
  <li>Mahalanobois (14.5 mins)</li>
</ul>

<h1 id="comparing-distances">Comparing Distances</h1>

<p>Here is some quick code to compare the MDMR results using the different distance measures.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1"># Setup</span>
</span><span class="line">setwd<span class="p">(</span><span class="s">&quot;/home2/data/Projects/CWAS/nki/cwas/short/try_distances/&quot;</span><span class="p">)</span>
</span><span class="line">library<span class="p">(</span>bigmemory<span class="p">)</span>
</span><span class="line">dirs <span class="o">&lt;-</span> Sys.glob<span class="p">(</span><span class="s">&quot;*/iq_age+sex+meanFD.mdmr/pvals.desc&quot;</span><span class="p">)</span>
</span><span class="line">pvals.mat <span class="o">&lt;-</span> sapply<span class="p">(</span>dirs<span class="p">,</span> <span class="kr">function</span><span class="p">(</span>d<span class="p">)</span> attach.big.matrix<span class="p">(</span>d<span class="p">)[,</span><span class="m">1</span><span class="p">])</span>
</span><span class="line">colnames<span class="p">(</span>pvals.mat<span class="p">)</span> <span class="o">&lt;-</span> sub<span class="p">(</span><span class="s">&quot;_k0800_to_k0800&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> dirname<span class="p">(</span>dirname<span class="p">(</span>dirs<span class="p">)))</span>
</span><span class="line"><span class="c1"># reorder according to Zapala paper</span>
</span><span class="line">tmp <span class="o">&lt;-</span> pvals.mat<span class="p">[,</span>c<span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">5</span><span class="p">)]</span>
</span><span class="line"><span class="c1"># Percent significant</span>
</span><span class="line">round<span class="p">(</span>cbind<span class="p">(</span>
</span><span class="line">	<span class="s">&#39;1&#39;</span><span class="o">=</span>colMeans<span class="p">(</span>tmp<span class="o">&lt;</span><span class="m">0.01</span><span class="p">),</span> 	
</span><span class="line">	<span class="s">&#39;5&#39;</span><span class="o">=</span>colMeans<span class="p">(</span>tmp<span class="o">&lt;</span><span class="m">0.05</span><span class="p">),</span>
</span><span class="line">	<span class="s">&#39;25&#39;</span><span class="o">=</span>colMeans<span class="p">(</span>tmp<span class="o">&lt;</span><span class="m">0.25</span><span class="p">),</span>
</span><span class="line">	<span class="s">&#39;50&#39;</span><span class="o">=</span>colMeans<span class="p">(</span>tmp<span class="o">&lt;</span><span class="m">0.50</span><span class="p">)</span>
</span><span class="line"><span class="p">)</span><span class="o">*</span><span class="m">100</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>
</span><span class="line"><span class="c1"># Correlate</span>
</span><span class="line">cor<span class="p">(</span>pvals.mat<span class="p">,</span> method<span class="o">=</span><span class="s">&quot;s&quot;</span><span class="p">)</span>
</span><span class="line"><span class="c1"># Dice-esque</span>
</span><span class="line">d.mat <span class="o">&lt;-</span> crossprod<span class="p">(</span>tmp<span class="o">&lt;</span><span class="m">0.05</span><span class="p">)</span>
</span><span class="line">print<span class="p">(</span>d.mat<span class="p">)</span> <span class="c1"># counts</span>
</span><span class="line">round<span class="p">(</span>sweep<span class="p">(</span>d.mat<span class="p">,</span> <span class="m">1</span><span class="p">,</span> diag<span class="p">(</span>d.mat<span class="p">),</span> <span class="s">&#39;/&#39;</span><span class="p">)</span><span class="o">*</span><span class="m">100</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span> <span class="c1"># percent overlap</span>
</span><span class="line"><span class="c1"># Dice</span>
</span><span class="line">numer <span class="o">&lt;-</span> <span class="m">2</span><span class="o">*</span>d.mat
</span><span class="line">denom <span class="o">&lt;-</span> <span class="p">(</span>diag<span class="p">(</span>d.mat<span class="p">)</span> <span class="o">%*%</span> t<span class="p">(</span>rep<span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">7</span><span class="p">)))</span> <span class="o">+</span> t<span class="p">(</span>diag<span class="p">(</span>d.mat<span class="p">)</span> <span class="o">%*%</span> t<span class="p">(</span>rep<span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">7</span><span class="p">)))</span>
</span><span class="line">dice <span class="o">&lt;-</span> numer<span class="o">/</span>denom
</span><span class="line">print<span class="p">(</span>round<span class="p">(</span>dice<span class="p">,</span> <span class="m">2</span><span class="p">))</span>
</span><span class="line"><span class="c1"># Voxels present in all distance measures</span>
</span><span class="line">sum<span class="p">(</span>rowSums<span class="p">(</span>pvals.mat<span class="o">&lt;</span><span class="m">0.05</span><span class="p">)</span><span class="o">==</span><span class="m">6</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Interesting that the correlation-based measures are all alike: concordance, kendall, pearson, and spearman with pearson as the most sensitive (180 significant voxels). Then euclidian and mahalanobois are fairly similar with both being the most sensitive overall (194 and 195 significant voxels, respectively). Significance here is p &lt; 0.05 (uncorrected…running analyses for corrected version now).</p>

<p>It’s also interesting that there are still differences in what voxel’s are identified as significant between the euclidian-based ones and the correlation-ones. For instance about 103 voxels are commonly significant between mahalanobois and pearson distance. If I look at those that are not common between mahalanobois and pearson distance, I do find that some of them are sub-threshold in the other measure. For instance, with p&lt;0.1 for pearson there are now 141 significant voxels in common with mahalanobois of p&lt;0.05.</p>

<h1 id="plotting">Plotting</h1>

<p>I want to now plot the different distances in surface. The script is located in <code>/home2/data/Projects/CWAS/share/nki/extra_distances</code> with the output going into <code>/home2/data/Projects/CWAS/nki/extra_distances</code>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2013/11/08/friday-save-the-date/">Friday - Save the Date</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2013-11-08T09:28:00-05:00" pubdate data-updated="true">Nov 8<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1 id="abide">ABIDE</h1>

<p>I am continuing to look into the ‘no space left on device’ error on gelert. First, I’ll attempt to understand what subject’s were deleted if at all.</p>

<h2 id="any-working-directories-deleted">Any Working Directories Deleted?</h2>

<p>I want to first figure out if the working directories are never deleted on gelert, which is potentially an easy fix, or if it is more sporadic. To test this, I will look at the subjects in the output directory but not in any of the working directories on gelert. Below are the 46 subjects that fall in that category indicating that some subjects are at least deleted.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class=""><span class="line"> [1] "0050642" "0050644" "0050650" "0050651" "0050652" "0050653" "0050654"
</span><span class="line"> [8] "0050655" "0050656" "0050657" "0050660" "0050661" "0050664" "0050666"
</span><span class="line">[15] "0050669" "0050682" "0050774" "0050776" "0050781" "0050785" "0050789"
</span><span class="line">[22] "0050791" "0050792" "0050794" "0050799" "0050802" "0050807" "0050808"
</span><span class="line">[29] "0050815" "0050825" "0050826" "0051456" "0051458" "0051461" "0051463"
</span><span class="line">[36] "0051464" "0051471" "0051475" "0051478" "0051480" "0051483" "0051485"
</span><span class="line">[43] "0051487" "0051491" "0051492" "0051493"</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="a-mix-of-working-directories-were-removed">A mix of working directories were removed</h3>

<p>Are these deleted working directories belong to participants with one of the first subject ids? That is are these the first subjects that were run? The answer appears both a yes and no, as you can see from the subject indices.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class=""><span class="line"> [1]   1   3   9  10  11  12  13  14  15  16  19  20  22  24  27  28  94  96 101
</span><span class="line">[20] 105 109 111 112 114 119 122 127 128 135 145 146 149 151 154 156 157 164 168
</span><span class="line">[39] 171 173 176 178 180 184 185 186</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="the-removed-directories-completed-functional-preprocessing">The removed directories completed functional preprocessing</h3>

<p>Now I wonder if participant’s with deleted working directories have completed workflows. I checked and all the 46 participants had a <code>functional_mni</code> that exists. Here is a sample path for the first participant: <code>/home2/data/Projects/ABIDE_Initiative/CPAC/Output_2013-11-05/sym_links/pipeline_MerrittIsland/_compcor_ncomponents_5_linear1.global1.motion1.quadratic1.compcor1.CSF_0.96_GM_0.7_WM_0.96/0050642_session_1/scan_rest_1_rest/func/functional_mni.nii.gz</code>.</p>

<h3 id="the-kept-directories-also-completed-functional-preprocessing">The kept directories also completed functional preprocessing</h3>

<p>I thought some of these might have failed at generating the <code>functional_mni</code>, however they are all there.</p>

<blockquote>
  <p>Note: the relevant script is <code>x_find_tmps.R</code>.</p>
</blockquote>

<hr />

<p>You regress out the covariates and </p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2013/11/07/thursday-lib-cmi-nyu/">Thursday Lib Cmi Nyu</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2013-11-07T11:17:00-05:00" pubdate data-updated="true">Nov 7<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1 id="abide">ABIDE</h1>

<p>On gelert, it has been over 2 days and it is now (morning of the 7th) on the 125th to 186th participant. However, it appears that there were many crashes for some participants.</p>

<p>Below are some crash files that I tried. Ultimately, it appears that there is no space left on the device for /tmp. This likely implies that the working directory folder is not being removed when it should. Ugh.</p>

<p>On rocky, the removal of the working directory works fine. I thought I had tried it for gelert too and found it was fine. I see a few possibilities.</p>

<ol>
  <li>Some error might occur as CPAC runs, which might lead it to skip removing the directory.</li>
  <li>It doesn’t actually remove the directory when running through SGE (maybe because it is using a different function). Note that removal of the working directory occurs at the very end in the cpac runner run function.</li>
  <li>There’s some issue with permissions and so a /tmp directory can be created but not removed. This can be easily tested.</li>
</ol>

<h2 id="sample-crash-file-a">Sample Crash File A</h2>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">import</span> <span class="nn">os</span>
</span><span class="line"><span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s">&#39;/data/Projects/ABIDE_Initiative/CPAC/crash&#39;</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="kn">from</span> <span class="nn">nipype.utils.filemanip</span> <span class="kn">import</span> <span class="n">loadflat</span>
</span><span class="line"><span class="n">crashfile</span> <span class="o">=</span> <span class="n">loadflat</span><span class="p">(</span><span class="s">&#39;crash-20131107-103920-qli-_apply_ants_3d_warp149.npz&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>This gives the following error</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="n">TraitError</span><span class="p">:</span> <span class="n">Each</span> <span class="n">element</span> <span class="n">of</span> <span class="n">the</span> <span class="s">&#39;transformation_series&#39;</span> <span class="n">trait</span> <span class="n">of</span> <span class="n">a</span> <span class="n">WarpImageMultiTransformInputSpec</span> <span class="n">instance</span> <span class="n">must</span> <span class="n">be</span> <span class="n">an</span> <span class="n">existing</span> <span class="nb">file</span> <span class="n">name</span><span class="p">,</span> <span class="n">but</span> <span class="n">a</span> <span class="n">value</span> <span class="n">of</span> <span class="s">&#39;/tmp/resting_preproc_00</span>
</span><span class="line"><span class="mi">50699</span><span class="n">_session_1</span><span class="o">/</span><span class="n">anat_mni_ants_register_0</span><span class="o">/</span><span class="n">warp_brain</span><span class="o">/</span><span class="n">ants_Warp</span><span class="o">.</span><span class="n">nii</span><span class="o">.</span><span class="n">gz</span><span class="s">&#39; &lt;type &#39;</span><span class="nb">str</span><span class="s">&#39;&gt; was specified.</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>It seems like a working directory file for this particular subject does not exist from this error. However, looking at the various functional/derivative outputs in subject’s folder that are in standard space, stuff appears the fine:</p>

<ul>
  <li>functional: <strong>good</strong></li>
  <li>alff: <strong>good</strong></li>
  <li>centrality: <strong>good</strong></li>
  <li>reho: <strong>good</strong></li>
  <li>sca_roi: Is there no standard space SCA map?</li>
  <li>dr: Is there no standard space SCA map?</li>
  <li>vmhc: <strong>good</strong></li>
</ul>

<p>I believe I might be missing some other relevant outputs.</p>

<h2 id="sample-crash-file-b">Sample Crash File B</h2>

<p>I get the following error for this crash file <code>crash-20131107-114514-qli-_network_centrality_smooth_10.npz</code>.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="n">TraitError</span><span class="p">:</span> <span class="n">The</span> <span class="s">&#39;in_file&#39;</span> <span class="n">trait</span> <span class="n">of</span> <span class="n">a</span> <span class="n">MultiImageMathsInput</span> <span class="n">instance</span> <span class="n">must</span> <span class="n">be</span> <span class="n">an</span> <span class="n">existing</span> <span class="nb">file</span> <span class="n">name</span><span class="p">,</span> <span class="n">but</span> <span class="n">a</span> <span class="n">value</span> <span class="n">of</span> <span class="s">&#39;/tmp/resting_preproc_0050702_session_1/centrality_zscore_1/_scan_rest_1_rest/_csf_threshold_0.96/_gm_threshold_0.7/_wm_threshold_0.96/_compcor_ncomponents_5_selector_pc10.linear1.wm0.global0.motion1.quadratic1.gm0.compcor1.csf0/_bandpass_freqs_0.01.0.1/_mask_mask_abide_90percent_gm/z_score/mapflow/_z_score0/degree_centrality_binarize_maths.nii.gz&#39;</span> <span class="o">&lt;</span><span class="nb">type</span> <span class="s">&#39;str&#39;</span><span class="o">&gt;</span> <span class="n">was</span> <span class="n">specified</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>So it seems like for this participant the fslmaths command was not run on the centrality outputs and later the smoothing was not applied. </p>

<h1 id="quick-pack">Quick Pack</h1>

<p>Let’s recre</p>

<h1 id="emotional-bs">Emotional-BS</h1>

<p>I want to focus on the QC to get that out of the way.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2013/11/06/wednesday-nki/">Wednesday Nki</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2013-11-06T14:59:00-05:00" pubdate data-updated="true">Nov 6<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1 id="abide">ABIDE</h1>

<p>We brought over the two drives with preprocessed ABIDE data from Pierre and Xinian to NKI. We attempted to mount the drives to rocky but got a “Not Authorized” error. I sent an email to Stan with Cameron cc’ed to see if we could deal with this issue (thinks we need sudo privileges).</p>

<p>Cameron will be getting sudo access and will figure out mounting the drive.</p>

<h1 id="nilearn">NiLearn</h1>

<p>The subjects for nilearn (ADHD40) appear to be done. I modified my prior compile scripts to take from the new preprocessed output (without nuisance correction and bandpass filtering). I re-uploaded the files to connectir and sent an email to Gael et al. So should be all done here.</p>

<p>I believe I do want to get access to ADHD200 nitrc sftp so I can upload the data to that site. Right now it is on my own connectir nitrc site.</p>

<h1 id="emotional-bs">Emotional-BS</h1>

<p>Read some articles. Check the QC.</p>

<h1 id="quick-pack">Quick-Pack</h1>

<p>Look into the GUI error…</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2013/11/05/rerunning-cwas-using-transformed-correlations/">Rerunning CWAS Using Transformed Correlations</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2013-11-05T20:26:00-05:00" pubdate data-updated="true">Nov 5<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>We had previously been using the semi-metric <code>1-r</code>, however are now with a reviewer’s suggestion switching to a metric using a slight transformation of the prior person correlation <code>sqrt(2*1-r)</code><sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>. This change although simple will require a massive effort to semi-reanalyze everything.</p>

<p>We also making another change in the way the permuted hat matrices are generated due to a last minute discovery by Phil. Previously, we had permuted the rows for the columns of interest. The issue with this approach is if the variable of interest is correlated with the covariates, then our permutation will effect both the variable of interest and our covariates. Consequently, we will regress out the covariates of non-interest from our variable of interest. We will then have the fitted response and the residuals. We will permute the order of the residuals and then add back the fitted response.</p>

<blockquote>
  <p>Note: I need to ask Phil what the approach is if your variable of interest has more than one column. I’m guessing you apply this procedure to each column of the variable separately?</p>
</blockquote>

<figure class="flickr-thumbnail testing my new creature" style="width: 240px;"><a href="http://farm6.staticflickr.com/5510/10896013916_4696b79800_z.jpg" class="fancybox" data-title-id="flickr-photo-10896013916" data-media="photo"><img src="http://farm6.staticflickr.com/5510/10896013916_4696b79800_m.jpg" title="Testing Brain" style="width: 240px; height: 164px;" /></a><figcaption id="flickr-photo-10896013916"><h1><a class="flickr-link" href="http://www.flickr.com/photos/96917171@N07/10896013916">Testing Brain</a> by czarrar</h1><div class="description"></div></figcaption></figure>

<h2 id="code">Code</h2>

<h3 id="transformation-of-distances">Transformation of Distances</h3>

<p>The first order of business is creating a function that easily transforms my big matrices and re-generates the gower centered matrices. A few nuances is that I need to make sure to set the number of threads to use in advance (otherwise all processors will be occupied) and to set the memory limit for gower centering.</p>

<p>The actual command can be called from bash with the following usage:</p>

<p><code>./transform_cor.R distance-descriptor memlimit nthreads</code></p>

<ul>
  <li><em>distance-descriptor</em>: File path to the subject distances descriptor</li>
  <li><em>memlimit</em>: Upper bound on RAM to use</li>
  <li><em>nthreads</em>: Number of threads to use for matrix algebra operations</li>
</ul>

<h3 id="permuting-residuals-of-predictor-variable">Permuting Residuals of Predictor Variable</h3>

<p>I made an addition to the MDMR model generation functions and made the new residual based approach of generating permuted hat matrices, the default. Below is the function (added within two functions). The critical new lines are highlighted.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>mark:5-9</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">permute_rhs_residuals <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">    <span class="c1"># H</span>
</span><span class="line">    Xj      <span class="o">&lt;-</span> rhs
</span><span class="line">    cols    <span class="o">&lt;-</span> grps <span class="o">%in%</span> u.grps<span class="p">[</span>f.ind<span class="p">]</span>
</span><span class="line">    <span class="c1">## permute residuals</span>
</span><span class="line">    <span class="kr">for</span> <span class="p">(</span>i <span class="kr">in</span> which<span class="p">(</span>cols<span class="p">))</span> <span class="p">{</span>
</span><span class="line">        model   <span class="o">&lt;-</span> lm<span class="p">(</span>Xj<span class="p">[,</span>i<span class="p">]</span> <span class="o">~</span> Xj<span class="p">[,</span><span class="o">!</span>cols<span class="p">])</span>
</span><span class="line">        Xj<span class="p">[,</span>i<span class="p">]</span>  <span class="o">&lt;-</span> model<span class="o">$</span>residuals<span class="p">[</span>o.inds<span class="p">]</span> <span class="o">+</span> model<span class="o">$</span>fitted.values
</span><span class="line">    <span class="p">}</span>
</span><span class="line">    <span class="c1">## hat matrixx</span>
</span><span class="line">    qrX     <span class="o">&lt;-</span> qr<span class="p">(</span>Xj<span class="p">,</span> tol<span class="o">=</span>TOL<span class="p">)</span>
</span><span class="line">    Q       <span class="o">&lt;-</span> qr.Q<span class="p">(</span>qrX<span class="p">)</span>
</span><span class="line">    H       <span class="o">&lt;-</span> tcrossprod<span class="p">(</span>Q<span class="p">[,</span><span class="m">1</span><span class="o">:</span>qrX<span class="o">$</span>rank<span class="p">])</span>
</span><span class="line">
</span><span class="line">    <span class="c1"># H2</span>
</span><span class="line">    cols    <span class="o">&lt;-</span> grps <span class="o">%in%</span> u.grps<span class="p">[</span><span class="o">-</span>f.ind<span class="p">]</span>
</span><span class="line">    Xj      <span class="o">&lt;-</span> rhs<span class="p">[,</span>cols<span class="p">]</span>
</span><span class="line">    qrX     <span class="o">&lt;-</span> qr<span class="p">(</span>Xj<span class="p">,</span> tol <span class="o">=</span> TOL<span class="p">)</span>
</span><span class="line">    Q       <span class="o">&lt;-</span> qr.Q<span class="p">(</span>qrX<span class="p">)</span>
</span><span class="line">    H2      <span class="o">&lt;-</span> H <span class="o">-</span> tcrossprod<span class="p">(</span>Q<span class="p">[,</span> <span class="m">1</span><span class="o">:</span>qrX<span class="o">$</span>rank<span class="p">])</span>
</span><span class="line">
</span><span class="line">    H2
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="normandy-aka-redoing-almost-all-figures">Normandy (aka Redoing Almost All Figures)</h2>

<h3 id="what-figures">What Figures</h3>

<p>Below are the list of figures in the main paper and whether I need to redo it or not.</p>

<ol>
  <li><strong>Yes</strong> Since this is an example figure, I don’t think I need to redo the particular analysis. However, I do need to edit the figure so it shows <code>sqrt(2*(1-r))</code>.</li>
  <li><strong>No</strong> Just a table.</li>
  <li><strong>Yes</strong> Redo 2 analyses and 3 surface maps.</li>
  <li><strong>Yes</strong> Redo 2 analyses and 2 histograms <em>(depends on 3)</em>.</li>
  <li><strong>Yes</strong> Redo network summary and surface map <em>(depends on 3)</em>.</li>
  <li><strong>Yes</strong> Redo 3 surface maps <em>(depends on 3)</em>.</li>
  <li><strong>Yes</strong> Redo 6 analyses and 6 surface maps <em>(depends on 3)</em>.</li>
  <li><strong>Yes</strong> Redo 2 scatter plots, 2 analyses, and 4 surface maps.</li>
  <li><strong>Yes</strong> Redo 2 bar plots.</li>
  <li><strong>Yes</strong> Redo 3 analyses, 3 surface maps, and 3 network summaries.</li>
  <li><strong>Yes</strong> Redo 4 analyses and 4 surface maps.</li>
  <li>
    <p><strong>Yes</strong> Redo 3 analyses and 4 surface maps.
Supplementary Figures</p>
  </li>
  <li><strong>Yes</strong> 3 analyses, 3 surface maps, and 2 scatter plots.</li>
  <li><strong>Yes</strong> ?</li>
  <li><strong>Yes</strong> 2 analyses and 2 surface maps.</li>
  <li><strong>Yes</strong> 6 analyses and 6 surface maps.</li>
  <li><strong>Yes</strong> 3 analyses and 3 surface maps.</li>
  <li><strong>Yes</strong> 3+ analyses and 3 plots.</li>
</ol>

<h3 id="figure-3-done">Figure 3 (DONE)</h3>

<h4 id="transformation--mdmr">Transformation + MDMR</h4>

<p>I’m running <code>32_mdmr_runner.bash</code>, which runs the following two commands:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">./30_mdmr.bash short compcor 8
</span><span class="line">./30_mdmr.bash medium compcor 8
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Each of those in turn will run the following commands (excerpt from longer script):</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nb">echo</span> <span class="s2">&quot;Voxelwise&quot;</span>
</span><span class="line"><span class="nv">sdistdir</span><span class="o">=</span><span class="s2">&quot;${distbase}/${strategy}_kvoxs${sm}_to_kvoxs${sm}&quot;</span>
</span><span class="line"><span class="nv">curdir</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>
</span><span class="line">
</span><span class="line"><span class="nb">cd</span> /home2/data/Projects/CWAS/share/lib
</span><span class="line">./transform_cor.R <span class="k">${</span><span class="nv">sdistdir</span><span class="k">}</span>/subdist.desc 30 12
</span><span class="line"><span class="nb">cd</span> <span class="nv">$curdir</span>
</span><span class="line">
</span><span class="line"><span class="nb">time </span>connectir_mdmr.R -i <span class="k">${</span><span class="nv">sdistdir</span><span class="k">}</span> <span class="se">\</span>
</span><span class="line">    --formula <span class="s2">&quot;FSIQ + Age + Sex + ${scan}_meanFD&quot;</span> <span class="se">\</span>
</span><span class="line">    --model <span class="k">${</span><span class="nv">subdir</span><span class="k">}</span>/subject_info_with_iq_and_gcors.csv <span class="se">\</span>
</span><span class="line">    --factors2perm <span class="s2">&quot;FSIQ&quot;</span> <span class="se">\</span>
</span><span class="line">    --permutations 14999 <span class="se">\</span>
</span><span class="line">    --forks 1 --threads 12 <span class="se">\</span>
</span><span class="line">    --memlimit 12 <span class="se">\</span>
</span><span class="line">    --save-perms <span class="se">\</span>
</span><span class="line">    --ignoreprocerror <span class="se">\</span>
</span><span class="line">    iq_age+sex+meanFD.mdmr
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h4 id="multiple-comparisons-correction">Multiple Comparisons Correction</h4>

<p>Then with <code>36_mdmr_correct_runner.bash</code>, I ran the following lines:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">./34_mdmr_correct.bash short compcor 8; <span class="se">\</span>
</span><span class="line">./34_mdmr_correct.bash medium compcor 8
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h4 id="plots">Plots</h4>

<p>Ran the same two set of scripts</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nb">cd</span> /home2/data/Projects/CWAS/share/figures/fig_03
</span><span class="line">./A1_cwas_iq_pysurfer_easythresh.py
</span><span class="line">./B1_cwas_iq_overlap_easythresh.py
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="figure-4-done">Figure 4 (DONE)</h3>

<p>This figure examines the percent of significant associations for each permutation (false positives) and creates a histogram.</p>

<h4 id="setup">Setup</h4>

<p>I use a reference set of permutations or my null distribution. I re-ran:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nb">cd</span> /home2/data/Projects/CWAS/share/nki/05_cwas
</span><span class="line"><span class="c"># I set the reference mdmr in these scripts</span>
</span><span class="line">./30_mdmr.bash short compcor 8
</span><span class="line">./30_mdmr.bash medium compcor 8
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h4 id="analysis">Analysis</h4>

<p>To generate the false positives, see <code>/home2/data/Projects/CWAS/share/results/20_cwas_iq/40_false_positives.R</code>. </p>

<h4 id="plot">Plot</h4>

<p>Then to plot the histogram, see <code>/home2/data/Projects/CWAS/share/figures/fig_03/D_signif_hists.R</code>.</p>

<h3 id="figure-5-done">Figure 5 (DONE)</h3>

<p>The relevant files for plotting are located in this directory <code>/home2/data/Projects/CWAS/share/figures/sfig_yeo</code>.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nb">cd</span> /home2/data/Projects/CWAS/share/figures/sfig_yeo
</span><span class="line">./A_pysurfer_yeo_and_cwas_iq.py
</span><span class="line">./B1_network_byarea.R
</span><span class="line">./B2_cropify.py
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="figure-6-done">Figure 6 (DONE)</h3>

<p>The files for plotting are located in <code>/home2/data/Projects/CWAS/share/figures/sfig_neurosynth</code>. Note that you will need to first plot the elements of Figure 3.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nb">cd</span> /home2/data/Projects/CWAS/share/figures/sfig_neurosynth
</span><span class="line">./10_combine_pysurfer.py
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="figure-7-done">Figure 7 (DONE)</h3>

<p>For the mean connectivity regression, I would use the same transformation as redone with Figure 3. I do need to redo the transformation for Figure 7.</p>

<p>The below script will run MDMR for IQ with mean connectivity as a covariate as well as for mean connectivity as the main effect.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">./30_mdmr_with_gcors.bash short compcor 8; <span class="se">\</span>
</span><span class="line">./30_mdmr_with_gcors.bash medium compcor 8
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>The below script will run MDMR for IQ using GSR corrected data.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">./33_mdmr_gsr.bash short compcor 8; <span class="se">\</span>
</span><span class="line">./33_mdmr_gsr.bash medium compcor 8
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h4 id="multiple-comparisons">Multiple Comparisons</h4>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># Mean Connectivity</span>
</span><span class="line">./34_mdmr_correct_with_gcors.bash short compcor 8; <span class="se">\</span>
</span><span class="line">./34_mdmr_correct_with_gcors.bash medium compcor 8
</span><span class="line"><span class="c"># GSR</span>
</span><span class="line">./34_mdmr_correct_gsr.bash short compcor 8; <span class="se">\</span>
</span><span class="line">./34_mdmr_correct_gsr.bash medium compcor 8
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h4 id="plots-1">Plots</h4>

<p>This is a 3 x 2 plot with </p>

<ul>
  <li>rows = type of processing (GSR, Mean Connectivity, No Correction)</li>
  <li>cols = scan (1, 2)</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nb">cd</span> /home2/data/Projects/CWAS/share/figures/fig_04
</span><span class="line"><span class="c"># Row 1: GSR</span>
</span><span class="line">./Aa_cwas_gsr_pysurfer_easythresh.py
</span><span class="line">
</span><span class="line"><span class="c"># Row 2: Mean Connectivity</span>
</span><span class="line">./Ab_cwas_mean_connectivity_pysurfer_easythresh.py
</span><span class="line">
</span><span class="line"><span class="c"># Row 3: Already Run (Fig 3)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="figure-8-done">Figure 8 (DONE)</h3>

<p>The relevant scripts to generate the plots are in <code>/home2/data/Projects/CWAS/share/figures/fig_05</code> and <code>/home2/data/Projects/CWAS/share/results/40_mdmr_glm</code> (although I’m not too sure how the second folder is relevant).</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nb">cd</span> /home2/data/Projects/CWAS/share/figures/fig_05
</span><span class="line">./A_glm_vs_mdmr_scatter_plots.R
</span><span class="line">./B_surface_glm_vs_mdmr_top_percentiles.py
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="figure-9-done">Figure 9 (DONE)</h3>

<p>The relevant analytic and plotting scripts are located in <code>/home2/data/Projects/CWAS/share/nki/08_sca_voxelwise</code> and <code>/home2/data/Projects/CWAS/share/nki/08_sca_voxelwise_scan2</code>. There’s actually not much analysis, just compiling the data together.</p>

<p>Note that I will need to also redo the statistics on this graph comparing the different ROI groups within each scan.</p>

<h4 id="scan-1">Scan 1</h4>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nb">cd</span> /home2/data/Projects/CWAS/share/nki/08_sca_voxelwise
</span><span class="line">./10_calc_peaks.bash
</span><span class="line">./20_select_rois.R
</span><span class="line">./30_sca.R
</span><span class="line">./40_plot.R
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h4 id="scan-2">Scan 2</h4>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nb">cd</span> /home2/data/Projects/CWAS/share/nki/08_sca_voxelwise_scan2
</span><span class="line">./10_calc_peaks.bash
</span><span class="line">./20_select_rois.R
</span><span class="line">./30_sca.R
</span><span class="line">./40_plot.R
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h4 id="outputs">Outputs</h4>

<p>The images for both scans should be in <code>figures/fig_06</code>.</p>

<h3 id="figure-10-done">Figure 10 (DONE)</h3>

<p>This figure covers CWAS for three different datasets.</p>

<h4 id="cwas">CWAS</h4>

<h5 id="development">Development</h5>

<p>Scripts are in <code>/home2/data/Projects/CWAS/share/development+motion/04_analysis</code>. I ran it as follows:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nb">cd</span> /home2/data/Projects/CWAS/share/development+motion/04_analysis
</span><span class="line">./02a_mdmr.bash <span class="c"># note ran all combos…relevant for supplementary</span>
</span><span class="line">./04_mdmr_correct.bash
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><strong>DONE</strong></p>

<h5 id="adhd">ADHD</h5>

<p>Scripts are in <code>/home2/data/Projects/CWAS/share/adhd200_rerun/05_analysis</code>. I ran it as follows:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nb">cd</span> /home2/data/Projects/CWAS/share/adhd200_rerun/05_analysis
</span><span class="line">./30_mdmr_combined.bash compcor
</span><span class="line">./50_mdmr_correct.bash compcor
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><strong>DONE</strong></p>

<h5 id="ldopa">LDOPA</h5>

<p>Scripts are in <code>/home2/data/Projects/CWAS/share/ldopa/04_analysis</code>. I ran it as follows:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nb">cd</span> /home2/data/Projects/CWAS/share/ldopa/04_analysis
</span><span class="line">./02a_mdmr.bash
</span><span class="line">./04_mdmr_correct.bash compcor
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><strong>DONE</strong></p>

<h4 id="plots-2">Plots</h4>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nb">cd</span> /home2/data/Projects/CWAS/share/figures/fig_07
</span><span class="line">./A_pysurfer_easythresh.py
</span><span class="line">./B1_network_byarea.R
</span><span class="line">./B2_cropify.py
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>The output goes to <code>figures/fig_07</code>.</p>

<h3 id="figure-11-done">Figure 11 (DONE)</h3>

<p>This requires redoing all the ROI-based MDMRs for the IQ analysis. Although this particular figure only shows one of the scans, might as well do both scans here as one of the supplementary figures will depend on it.</p>

<p>Below are the commands that I ran. Note that the mdmr commands will also transform the previous distances.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nb">cd</span> /home2/data/Projects/CWAS/share/nki/05_cwas
</span><span class="line">./30_mdmr_rois.bash short compcor 0
</span><span class="line">./34_mdmr_correct_rois.bash short compcor 0
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>To plot the data in surface space, I need to run the following</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nb">cd</span> /home2/data/Projects/CWAS/share/figures/sfig_roi_comparison
</span><span class="line">./30_parcellations_pysurfer.py
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>The results will be in <code>/home2/data/Projects/CWAS/figures/sfig_roi_comparison</code>.</p>

<h3 id="figure-12-done">Figure 12 (DONE)</h3>

<p><strong>I need to redo the MDMR Analyses</strong></p>

<p>Here, we’ll need to redo the 800 parcellations for the other 3 datasets. I should have the IQ results from Figure 11.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># Development</span>
</span><span class="line"><span class="nb">cd</span> /home2/data/Projects/CWAS/share/development+motion/04_analysis
</span><span class="line">./02a_mdmr_rois.bash <span class="c"># this runs correction as well</span>
</span><span class="line">
</span><span class="line"><span class="c"># ADHD</span>
</span><span class="line"><span class="nb">cd</span> /home2/data/Projects/CWAS/share/adhd200_rerun/05_analysis
</span><span class="line">./30_mdmr_combined_rois.bash compcor
</span><span class="line">
</span><span class="line"><span class="c"># LDOPA</span>
</span><span class="line"><span class="nb">cd</span> /home2/data/Projects/CWAS/share/ldopa/04_analysis
</span><span class="line">./02a_mdmr_rois.bash
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>To generate the images, do the following:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nb">cd</span> /home2/data/Projects/CWAS/share/figures/sfig_roi_comparison
</span><span class="line">./40_comparison_datasets_pysurfer.py
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Output can be found in <code>/home2/data/Projects/CWAS/figures/sfig_roi_comparison</code>.</p>

<h3 id="supp-figure-1-done">Supp Figure 1 (DONE)</h3>

<p>This one definitely needs redoing as it directly displays the distances.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nb">cd</span> /home2/data/Projects/CWAS/share/nki/06_stability
</span><span class="line">./14_stability_N104.R
</span><span class="line">./24_zscore_N104.R
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Output can be found in <code>/home2/data/Projects/CWAS/nki/stability/N104_compcor_kvoxs_fwhm08_to_kvoxs_fwhm08</code>.</p>

<p>To generate the plots run:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nb">cd</span> /home2/data/Projects/CWAS/share/figures/fig_02
</span><span class="line">./A_pysurfer_cv_zscore.py
</span><span class="line">./B_pysurfer_consistency_zscore.py
</span><span class="line">./C_scatter_plot_cv_vs_consistency.R
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>The output will be in <code>figures/fig_02</code>.</p>

<h3 id="supp-figure-2-done">Supp Figure 2 (DONE)</h3>

<p><strong>REDO DUE TO OTHER 3 DATASETS</strong></p>

<p>This figure shows each of the dataset results using the permutation-based correction.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nb">cd</span> /home2/data/Projects/CWAS/share/figures/sfig_permutation
</span><span class="line">./A_iq_pysurfer_perms.py
</span><span class="line">./B_others_pysurfer_perms.py
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Output can be found in <code>/home2/data/Projects/CWAS/figures/sfig_permutations</code>.</p>

<h3 id="supp-figure-3-done">Supp Figure 3 (DONE)</h3>

<p>Shows the mean connectivity for IQ dataset.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nb">cd</span> /home2/data/Projects/CWAS/share/figures/fig_04
</span><span class="line">./B_cwas_global_pysurfer_easythresh.py
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Output can be found in <code>figures/fig_04</code>.</p>

<h3 id="supp-figure-4-done">Supp Figure 4 (DONE)</h3>

<p>This compares preprocessing effects on CWAS for age looking at inclusion/exclusion of global and motion covariates.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nb">cd</span> /home2/data/Projects/CWAS/share/figures/sfig_dev_global
</span><span class="line">./A_pysurfer_easythresh.py
</span><span class="line">./x_comparison.R
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Output is in <code>figures/sfig_dev_motion_global</code>.</p>

<h3 id="supp-figure-5-done">Supp Figure 5 (DONE)</h3>

<p>This directly examines the effect of motion across different global correction strategies.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nb">cd</span> /home2/data/Projects/CWAS/share/figures/sfig_motion
</span><span class="line">./A_pysurfer_easythresh.py
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Output is in <code>figures/sfig_motion</code>.</p>

<h3 id="supp-figure-6-done">Supp Figure 6 (DONE)</h3>

<p>Last one that varies the number of parcellations and examines the effect of parcellation set on 3 different measures.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nb">cd</span> /home2/data/Projects/CWAS/share/figures/sfig_roi_comparison
</span><span class="line">./10_plot_parcel_metrics.R
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Output is in <code>figures/sfig_roi_comparison</code>.</p>
<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>I am still working on getting latex to work so these math equations will be not be displayed well for now.<a href="#fnref:1" rel="reference">&#8617;</a></p>
    </li>
  </ol>
</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2013/11/05/tuesday/">Tuesday</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2013-11-05T15:26:00-05:00" pubdate data-updated="true">Nov 5<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1 id="nilearn">NiLearn</h1>

<p>I need to regenerate the 4D output. I previously used data with nuisance co-variates removed, however I should have used the data prior to nuisance correction. Remember the data’s location<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>.</p>

<p>So again I want to turn off nuisance correction and bandpass filtering. In order to do this, I’m rerunning (on top of the old) the participants with nuisance and bandpass turned off.</p>

<p>Checking on the preprocessing, it initially skipped a bunch of things but now seems to be running some initial steps again. If this takes too long (i.e., is still going into tomorrow), then I might try to apply the warp myself tomorrow.</p>

<hr />

<h1 id="abide">ABIDE</h1>

<p>Since the QC pages have been fixed, I started to re-run the ABIDE analysis. This time I used 6mm of smoothing, added back the degree centrality, and running each subject with 4 cores on gelert. It is running strong (for now). There are 1102 subjects to run and currently 62 are being run in parallel.</p>

<hr />

<h1 id="emotional-bs">Emotional BS</h1>

<p>I ran the preprocessing for these participants before the QC issue for CPAC was fixed. Now I want to rebuild just the QC as follows:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">import</span> <span class="nn">sys</span>
</span><span class="line"><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&#39;/home2/data/Projects/CPAC_Regression_Test/nipype-installs/fcp-indi-nipype/running-install/lib/python2.7/site-packages&#39;</span><span class="p">)</span>
</span><span class="line"><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;/home/milham/Downloads/cpac_master&quot;</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="kn">import</span> <span class="nn">CPAC</span>
</span><span class="line"><span class="n">CPAC</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">create_all_qc</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s">&#39;/home2/data/Projects/Emotional-BS/processed_data&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>This does work but I then later noticed that I used 4.5mm as the smoothness instead of 6mm. I may need to rerun this down the line? Since for now this only effects derivatives, which I’m not really using, then this shouldn’t be an issue.</p>

<p>I also looked into co-registering the two anatomicals. I ended up dropping this endeavor for now since the gain in SNR and benefit to any results should not be too great. In looking at the QC, one possibility is that we may want to replace one of our anatomicals with the other anatomical.</p>

<h2 id="multi-instance-learning">Multi-Instance Learning</h2>

<p>I did a basic search for relevant reading material. I found the following:</p>

<p><em>A paper outlining the approach in a seemingly easy manner.</em>
http://pages.ucsd.edu/~ztu/courses/2013_CS_spring/reading/bbabenko_re.pdf</p>

<p><em>Very detailed slides that appear to give a good overview.</em>
http://www.cs.columbia.edu/~andrews/pub/talk-proposal-july8-clean.pdf</p>

<p><em>Two links with relevant python code</em><br />
http://engr.case.edu/doran_gary/code.html<br />
https://github.com/garydoranjr/misvm</p>

<hr />

<h1 id="todo">TODO</h1>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="p">[]</span> <span class="n">NiLearn</span> <span class="n">Test</span> <span class="n">Data</span>
</span><span class="line">	<span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="n">Sent</span> <span class="n">email</span> <span class="n">confirming</span> <span class="n">that</span> <span class="n">band</span><span class="o">-</span><span class="k">pass</span> <span class="n">filtering</span> <span class="ow">is</span> <span class="n">required</span>
</span><span class="line">	<span class="p">[]</span> <span class="n">Get</span> <span class="n">the</span> <span class="n">pre</span><span class="o">-</span><span class="n">nuisance</span> <span class="n">variables</span>
</span><span class="line"><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="n">ABIDE</span> <span class="n">Preprocessing</span>
</span><span class="line">	<span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="n">Restart</span> <span class="n">the</span> <span class="n">preprocessing</span> <span class="n">using</span> <span class="mi">4</span> <span class="n">cores</span> <span class="p">(</span><span class="n">everything</span> <span class="k">except</span> <span class="n">eigen</span><span class="p">)</span>
</span><span class="line"><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="n">Emotional</span> <span class="n">BS</span>
</span><span class="line">	<span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="n">Try</span> <span class="n">to</span> <span class="n">regenerate</span> <span class="n">the</span> <span class="n">QC</span> <span class="n">pages</span> <span class="n">based</span> <span class="n">on</span> <span class="n">current</span> <span class="n">output</span>
</span><span class="line">	<span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="n">Lookup</span> <span class="n">some</span> <span class="n">multi</span><span class="o">-</span><span class="n">instance</span> <span class="n">learning</span> <span class="n">stuff</span>
</span><span class="line">	<span class="p">[]</span> <span class="n">QC</span>
</span><span class="line"><span class="p">[]</span> <span class="n">QuickPack</span>
</span><span class="line">	<span class="p">[]</span> <span class="err">?</span> <span class="p">(</span><span class="ow">not</span> <span class="n">enough</span> <span class="n">time</span> <span class="n">today</span> <span class="n">to</span> <span class="n">make</span> <span class="n">substantial</span> <span class="n">progress</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p><code>/home2/data/Projects/CPAC_Regression_Test/2013-10-04_v0-3-2/run/gael-o/package</code><a href="#fnref:1" rel="reference">&#8617;</a></p>
    </li>
  </ol>
</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2013/11/04/bootstrap-of-iq-cwas/">Bootstrap of IQ CWAS</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2013-11-04T23:38:00-05:00" pubdate data-updated="true">Nov 4<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>As per one of the reviewer comments, I am assessing the reproducibility of CWAS with a bootstrap analysis. I am only examining the results from the IQ dataset and will be looking at both the scans.</p>

<h2 id="bootstrap-with-subsampling">Bootstrap with Subsampling</h2>

<p>I randomly generated 500 samples of subject indices that were 90% of my original set. For each sample, I computed a standard MDMR for IQ. The script for running the short scan can be found at <code>/home/data/Projects/CWAS/share/nki/09_bootstrap/10_boot_voxelwise_short.R</code>.</p>

<p><strong>DONE</strong></p>

<p>Now we want to represent a few aspects of the data. The easiest approach here is for us to plot the correlation and dice values comparing the different subsamples. This could help show how reproducible the different bootstrap samples are for our data. We can also further visualize this with surface maps of two of the samples with a median dice coefficient. In summary, todo:</p>

<ul>
  <li>Histogram of percent significant results (just for reference)</li>
  <li>Correlate and dice</li>
  <li>Plot two samples on brain</li>
</ul>

<h3 id="code-to-plot">Code to Plot</h3>

<p>I want to write this code to export the relevant figures to flickr, which I can then use here and in any of my pages documents.</p>

<p>The relevant scripts to plot are in <code>/home2/data/Projects/CWAS/share/figures/sfig_bootstrap</code> with output directed to <code>/home2/data/Projects/CWAS/figures/sfig_bootstrap</code>.</p>

<hr />

<h2 id="bootstrap-with-replication">Bootstrap with Replication</h2>

<p>Note I do not take this approach anymore but I have included it for posterity (is that spelled right).</p>

<h3 id="analysis">Analysis</h3>

<p>I conducted the CWAS as a plugin with the <code>boot</code> package. The actual code can be seen with the github gist at the end. Note that the boot package resamples with replacement.</p>

<p>After I got the p-values, I computed a correlation between all the possible pairs of bootstrap sample results. I used a spearman correlation so the exact transformation of the p-value to something more appropriate wasn’t necessary. To me these values appear a bit low.</p>

<h3 id="plotting">Plotting</h3>

<p>I want to look at a randomish sampling of the results to see how similar or dissimilar things appear.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">mpath <span class="o">&lt;-</span> file.path<span class="p">(</span><span class="s">&quot;/home2/data/Projects/CWAS/nki/cwas&quot;</span><span class="p">,</span> scan<span class="p">,</span>  <span class="s">&quot;compcor_kvoxs_fwhm08_to_kvoxs_fwhm08/mask.nii.gz&quot;</span><span class="p">)</span>
</span><span class="line">mask  <span class="o">&lt;-</span> read.mask<span class="p">(</span>mpath<span class="p">)</span>
</span><span class="line">hdr   <span class="o">&lt;-</span> read.nifti.header<span class="p">(</span>mpath<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="histogram-issue">Histogram Issue</h3>

<p>When I examine the histogram of p-values for the original ordering compared to 2 bootstrap samples, I find some striking differences.</p>

<p>So my thought now is to see if the bootstrap approach with <code>boot</code> is shifting things in the wrong direction.</p>

<p>My analysis/tests show that bootstrap with replication is not appropriate here and instead we should be using subsampling (bootstrapping without replication).</p>

<p>http://rpubs.com/czarrar/cwas_distributions</p>

<h4 id="older-approach">Older approach</h4>

<p>I previously had examined the proportion of significant results across bootstrap samples. The basic plots can be found on http://rpubs.com/czarrar/cwas-bootstrap.</p>

<h3 id="code">Code</h3>

<div><script src="https://gist.github.com/7164165.js?file=cwas_bootstrap.R"></script>
<noscript><pre><code>library(connectir)
library(boot)

# data = model
boot_mdmr &lt;- function(formula, data, indices, sdist, factors2perm) {
    ###
    # Distances
    ###
    
    # We need to sample the distances based on the indices
    # that is we will create a new set of distances with subject indices based on indices
    # This will also create a local copy of the big matrix
    cat(&quot;Subset of subjects in distances\n&quot;)
    sdist &lt;- filter_subdist(sdist, subs=indices)
    
    # Now we can gowerify
    cat(&quot;Gowerify\n&quot;)
    gmat &lt;- gower.subdist2(sdist)
    
    # Info
    nvoxs &lt;- ncol(gmat)
    nsubs &lt;- sqrt(nrow(gmat))
    nperms &lt;- 4999
    nfactors &lt;- 1
    
    
    ###
    # Calculate memory demands
    ###
    opts &lt;- list(verbose=TRUE, memlimit=20, blocksize=0, superblocksize=0)
    opts &lt;- get_mdmr_memlimit(opts, nsubs, nvoxs, nperms, nfactors)
    # this will give opts$blocksize and opts$superblocksize that will
    # limit total RAM usage to 20GB
    
    ###
    # Get the model ready
    ###
    
    cat(&quot;Subset of subjects in model\n&quot;)
    model &lt;- data.frame(data[indices,])
    
    
    ###
    # Call MDMR
    ###
    
    ret &lt;- mdmr(gmat, formula, model, nperms, factors2perm, 
                 superblocksize=opts$superblocksize, blocksize=opts$blocksize)
    
    -log10(ret$pvals[,]) # or should I just return p-values?
}


###
# Bootstrap ROI-based IQ Results
###

# Set parallel processing
nthreads &lt;- 8
set_parallel_procs(1, nthreads, TRUE)

# Read in the distances (using ROI-based distances and not voxelwise here)
#dpath &lt;- &quot;/home2/data/Projects/CWAS/nki/cwas/short/compcor_kvoxs_fwhm08_to_kvoxs_fwhm08/subdist.desc&quot;
dpath &lt;- &quot;/home2/data/Projects/CWAS/nki/cwas/short/compcor_only_rois_random_k0800/subdist.desc&quot;
sdist &lt;- attach.big.matrix(dpath)

# Read in the model
mpath &lt;- &quot;/home2/data/Projects/CWAS/share/nki/subinfo/40_Set1_N104/subject_info_with_iq_and_gcors.csv&quot;
model &lt;- read.csv(mpath)
model &lt;- subset(model, select=c(&quot;FSIQ&quot;, &quot;Age&quot;, &quot;Sex&quot;, &quot;short_meanFD&quot;))

# Set the formula
f     &lt;- ~ FSIQ + Age + Sex + short_meanFD

# Call
results &lt;- boot(data=model, statistic=boot_mdmr, R=500, formula=f, sdist=sdist, factors2perm=&quot;FSIQ&quot;)
</code></pre></noscript></div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2013/11/04/monday/">Monday</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2013-11-04T12:20:00-05:00" pubdate data-updated="true">Nov 4<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1 id="nilearn-test-data">NiLearn Test Data</h1>

<p>Note that the code to generate all this is as well as the actual package is in <code>/home/data/Projects/CPAC_Regression_Test/2013-10-04_v0-3-2/run/gael-o/package</code>.</p>

<p>I’ve already gotten the subject data and regressors. I am left to create the group phenotypic file. It appears that I don’t need to duplicate the previous setup so I can use what we have on motion per subject. With this new data packaged up, I uploaded it to my connectir repository as I still don’t have access to the ADHD200 repository.</p>

<p>The download links are below:</p>

<p>http://connectir.projects.nitrc.org/adhd40_p1.nii.gz
http://connectir.projects.nitrc.org/adhd40_p2.nii.gz
http://connectir.projects.nitrc.org/adhd40_p3.nii.gz
http://connectir.projects.nitrc.org/adhd40_p4.nii.gz</p>

<p>And I have contacted the other peeps about this. So DONE.</p>

<hr />

<h1 id="abide-preprocessing">ABIDE Preprocessing</h1>

<p>I found out that the QC pages are a little broken. So this will have to wait.</p>

<h2 id="run-config-setup">Run Config Setup</h2>

<p>I have adjusted this file to run one subject for every two nodes. I am using FSL5 now. Preprocessing will be run as well as all the derivatives except centrality (degree or eigen). This is because they both need a decent amount of RAM and computational time so I’ll wait to run them separately later.</p>

<hr />

<h1 id="quickpack">QuickPack</h1>

<p>So the first general issue that I’m experiencing is that if I run everything (no quick-pack), then I don’t get any of the sym links. However, in my Emotional-BS run, the symlinks all seem to be fine! A little weird. I’m not sure what is causing the problem.</p>

<h2 id="running-with-just-cpac">Running with just CPAC</h2>

<p>I’m focusing on why I’m getting symlink issues when I run internally with CPAC. I think the reasons that no files are being symlinked is because there might be single quotes in the strategy part of the path.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">ln -s /home2/data/Projects/ABIDE_Initiative/CPAC/test_qp/All_Output/pipeline_RameyBorough/0051466_session_1/qc/mni_normalized_anatomical_a/mni_anat_a.png /home2/data/Projects/ABIDE_Initiative/CPAC/test_qp/All_Output/sym_links/pipeline_RameyBorough/_compcor_<span class="s1">&#39;ncomponents_5_linear1.global1.motion1.quadratic1.compcor1.csf0&#39;</span>_CSF_0.96_GM_0.7_WM_0.96/0051466_session_1/scan/qc/mni_anat_a.png
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>If I run this command that was spit out from CPAC, then I get a “No such file or directory” error. This error doesn’t appear with CPAC but this might explain why no symlinks were generated.</p>

<p>Now we must understand why those single quotes are there. We should note that there were actually 2 strategies that I had given but only one strategy folder in the symlinks directory folder was created. I wonder if this has to do with some error?</p>

<p>I tried to open the config file with the GUI and re-save it, seeing if that would help but it didn’t. Now I’ll try to run the pipeline from the GUI. Yup that fixed the issue and it isn’t related to the fact that I’m using Dan’s path and shiz. Running this one subject through the GUI.</p>

<h2 id="running-alff">Running ALFF</h2>

<p>There was one previous and confusing link issue. However, another issue that I didn’t notice was the ALFF output directory using single quotes in its symlinks strategy directory and only has one of the two strategies. This suggests a potential benefit in running this through the GUI.</p>

<h3 id="gui">GUI</h3>

<p>This run failed. The error message is below. I am not sure what’s going on.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">Invalid Connection: ALFF: 0  resource_pool:  <span class="o">{}</span>
</span><span class="line">Process Process-3:
</span><span class="line">Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class="line">  File <span class="s2">&quot;/home2/dlurie/Canopy/appdata/canopy-1.0.3.1262.rh5-x86_64/lib/python2.7/multiprocessing/process.py&quot;</span>, line 258, in _bootstrap
</span><span class="line">    self.run<span class="o">()</span>
</span><span class="line">  File <span class="s2">&quot;/home2/dlurie/Canopy/appdata/canopy-1.0.3.1262.rh5-x86_64/lib/python2.7/multiprocessing/process.py&quot;</span>, line 114, in run
</span><span class="line">    self._target<span class="o">(</span>*self._args, **self._kwargs<span class="o">)</span>
</span><span class="line">  File <span class="s2">&quot;/home2/dlurie/Enthought/Canopy_64bit/User/lib/python2.7/site-packages/CPAC/pipeline/cpac_pipeline.py&quot;</span>, line 1198, in prep_workflow
</span><span class="line">    alff, <span class="s1">&#39;inputspec.rest_res&#39;</span><span class="o">)</span>
</span><span class="line">  File <span class="s2">&quot;/home2/dlurie/Enthought/Canopy_64bit/User/lib/python2.7/site-packages/nipype/pipeline/engine.py&quot;</span>, line 306, in connect
</span><span class="line">    self._check_nodes<span class="o">(</span>newnodes<span class="o">)</span>
</span><span class="line">  File <span class="s2">&quot;/home2/dlurie/Enthought/Canopy_64bit/User/lib/python2.7/site-packages/nipype/pipeline/engine.py&quot;</span>, line 769, in _check_nodes
</span><span class="line">    <span class="k">if </span>node.name in node_names:
</span><span class="line">AttributeError: <span class="s1">&#39;NoneType&#39;</span> object has no attribute <span class="s1">&#39;name&#39;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="cli">CLI</h3>

<p>The error on the command-line is driven in part by two correction strategies (with and without global). Since my quick pack, can’t really do both of those strategies at once anyway, why not just have one strategy specified. Trying this with ALFF and that didn’t work! Ugh so it’s specifically related to the command-line, which is doing something differently than the GUI.</p>

<hr />

<h1 id="emotional-bs">Emotional-BS</h1>

<p>The preprocessing is done but the QC pages were not generated due to some issue in CPAC. I wish there was some way of running the QC scripts with the current outputs without me having to re-run all of CPAC. Since I ran via gelert using the <code>/tmp</code> directory, it will also need to redo all the processing.</p>

<hr />

<h1 id="random">Random</h1>

<p>I spent a bit of time getting the table of contents to work on these pages. Hopefully it was worth it (I might want to also add a go back to the top link for each header). At the very least it gives a sort-of summary list of what will be on the post.</p>

<p>I think I also had a bit of trouble keeping on track today. It was very frustrating and I’m hoping it was just re-adjusting to coming back to work after a brief break.</p>

<hr />

<h1 id="todo">TODO</h1>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="o">[</span>x<span class="o">]</span> NiLearn Test Data
</span><span class="line">	<span class="o">[</span>x<span class="o">]</span> Generate group phenotype file
</span><span class="line"><span class="o">[]</span> ABIDE Preprocessing
</span><span class="line">	<span class="o">[</span>x<span class="o">]</span> Email Cam about next steps
</span><span class="line">	<span class="o">[</span>x<span class="o">]</span> Setup the pipeline with gelert excluding centrality
</span><span class="line">	<span class="o">[]</span> Start running the pipeline
</span><span class="line"><span class="o">[]</span> QuickPack
</span><span class="line">	<span class="o">[</span>x<span class="o">]</span> Check that <span class="nb">complete </span>run was good
</span><span class="line">	<span class="o">[</span>x<span class="o">]</span> Try to figure out why the old runs did fine?
</span><span class="line">	<span class="o">[]</span> Using the new <span class="nb">complete </span>run as input <span class="k">for </span>QP
</span></code></pre></td></tr></table></div></figure></notextile></div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2013/11/03/cwas-computational-complexity/">CWAS Computational Complexity</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2013-11-03T20:06:00-05:00" pubdate data-updated="true">Nov 3<span>rd</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I want to look at the theoretical complexity below and also the empirical complexity both as a function of the number of subjects and voxels. For the empirical complexity, let me note the total time and also the times for each of the subunits. This way, I can concur my theoretical timing. But really in the end, I want to see that as I increase the number of subjects and the number of connections, what is the relative change in the time.</p>

<hr />

<p>I’m trying to address some reviewer questions regarding the computational complexity of CWAS and particularly the MDMR step.</p>

<p>In summary, the complexity is</p>

<ul>
  <li>O(V^3*n) for computing the connectivity maps</li>
  <li>O(V^2*n^2) for computing the distance matrices</li>
  <li>O(k*n^2) for creating the hat matrices</li>
  <li>O(V*n^3) for gower centering the distance matrices</li>
  <li>O(Pxn^2xV) for MDMR</li>
</ul>

<p>where V = # of voxels, n = # of subjects, k = # of regressors, P = # of permutations.</p>

<p>The real optimization is the final MDMR step, where the traditional MDMR approach is O(Pxn^3xV) or O(n^3) whereas ours is O(n^2).</p>

<h1 id="about-time-complexity">About Time Complexity</h1>

<p>My first step here is to build up some knowledge about the computational time needed for computing the different steps. I searched the terms computational complexity and time complexity but could have also looked at Big-O Notation. It seems like time complexity is the most appropriate term.</p>

<p>Efficiency of an algorithm can be measured by [1]:</p>

<ul>
  <li>Execution time (time complexity)</li>
  <li>Amount of memory required (space complexity)</li>
</ul>

<p>Time complexity expresses the relationship between the size of the size of the input and the run time for the algorithm. There’s other relevant information on the wiki page and some online slides [2,3].</p>

<h2 id="complexity-of-math-operations">Complexity of Math Operations</h2>

<p>For measuring the complexity of individual operations, wikipedia has a great summary page [4]. Although it gives difference values for the elementary addition and multiplications, it seems one might assume they run in linear or quasi-linear time (based on other pages?). However, technically multiplication is n^2 or n*log(n) (depending on the implementation). Matrix multiplication is n^3. This is a little weird because I think of the correlation coefficient as n^2 since that is the number of pairwise correlations you are computing and according to a cs stackexchange post, pearson correlation is O(n) [5].</p>

<h1 id="cwas-complexity">CWAS Complexity</h1>

<p>So I guess that’s all the background I need. Now let’s figure out the complexity of CWAS. Since the computation of the connectivity maps is shared amongst many algorithms, I will ignore that step and start from the computation of the distance matrices.</p>

<h2 id="distance-matrices">Distance Matrices</h2>

<p>This step is done independently at each voxel. And, at a voxel, we have connectivity with m voxels across n participants. On this <code>mxn</code> matrix, we compute the pearson correlation between the m connectivity maps for all possible pairs of participants. Assuming that each correlation is computed in O(n) time [5], changing the number of voxels will lead to an O(n) change while changing the number of subjects will lead to an O(n^2) change. Thus, this step should be O(V*n^2).</p>

<h2 id="mdmr">MDMR</h2>

<h3 id="hat-matrix">Hat Matrix</h3>

<p>This step involves <code>H = X ( X^T X )^-1 X^T</code>. Note that <code>X</code> is n participants x k regressors. So from the formula, we can see that there are</p>

<ul>
  <li>3 matrix algebra operations</li>
  <li>1 matrix inversion</li>
  <li>2 transpositions (but I won’t count those)</li>
</ul>

<p>Each of these operations is O(k<em>n^2) [4] so this step has O(k</em>n^2) complexity. This I believe would be around the complexity of multiple linear regression for one voxel as well [6].</p>

<h3 id="gower-matrix">Gower Matrix</h3>

<p>This step involves <code>G = (I - 11^T/n) * A * (I - 11^T/n)</code>. Note that <code>I</code> is the identity matrix (n x n), <code>1</code> is a vector of n 1’s, and <code>A</code> is half the squared distance matrix. So from the formula, we can see</p>

<ul>
  <li>2 subtractions (additions)</li>
  <li>2 divisions (multiplications)</li>
  <li>2 matrix multiplications</li>
</ul>

<p>Since the matrix operation will dominate the time, the complexity is O(V*n^3) where V is the number of voxels.</p>

<h3 id="pseudo-f-statistic">Pseudo-F Statistic</h3>

<p>This step involves <code>(HG/(k-1))/((I-H)G/(n-m))</code>. The division parts are not really relevant for the complexity and indeed are not needed when computing the permutations (McArdle and Anderson, 2001), so we actually have <code>(HG)/((I-H)G)</code>. Here H is a vector of hat matrix vectors so it’s a P x n^2 matrix (P = # of permutations) and G is a vector of gower matrices so it’s a n^2 x V matrix (V = # of voxels). This means that there are:</p>

<ul>
  <li>1 subtraction (I-H)</li>
  <li>2 matrix multiplications</li>
  <li>1 division</li>
</ul>

<p>Since the matrix multiplication takes the dominant time, we can ignore the other two division operations. The computational complexity is then O(Pxn^2xV) so as in the distance matrix step the complexity will scale by n^2.</p>

<h1 id="references">References</h1>

<ol>
  <li>http://www.csd.uwo.ca/courses/CS1037a/notes/topic13_AnalysisOfAlgs.pdf</li>
  <li>http://en.wikipedia.org/wiki/Time_complexity</li>
  <li>http://www-fourier.ujf-grenoble.fr/~demailly/manuscripts/kvpy-print.pdf</li>
  <li>http://en.wikipedia.org/wiki/Computational_complexity_of_mathematical_operations</li>
  <li>http://cs.stackexchange.com/questions/2604/whats-the-complexity-of-spearmans-rank-correlation-coefficient-computation</li>
  <li>http://math.stackexchange.com/questions/84495/computational-complexity-of-least-square-regression-operation</li>
</ol>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/5/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/3/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    
  

<section>
  <h1>Tag Cloud</h1>
    <span id="tag-cloud"><a href='/blog/categories/abide' style='font-size: 132.30769230769232%'>abide(7)</a> <a href='/blog/categories/cmi' style='font-size: 160.0%'>cmi(13)</a> <a href='/blog/categories/cpac' style='font-size: 146.15384615384616%'>cpac(10)</a> <a href='/blog/categories/cwas' style='font-size: 146.15384615384616%'>cwas(10)</a> <a href='/blog/categories/emotional-bs' style='font-size: 109.23076923076923%'>emotional-bs(2)</a> <a href='/blog/categories/jekyll' style='font-size: 104.61538461538461%'>jekyll(1)</a> <a href='/blog/categories/mdmr' style='font-size: 104.61538461538461%'>mdmr(1)</a> <a href='/blog/categories/nilearn' style='font-size: 113.84615384615384%'>nilearn(3)</a> <a href='/blog/categories/quickpack' style='font-size: 127.6923076923077%'>quickpack(6)</a> <a href='/blog/categories/r' style='font-size: 104.61538461538461%'>r(1)</a> <a href='/blog/categories/simulations' style='font-size: 104.61538461538461%'>simulations(1)</a> <a href='/blog/categories/work' style='font-size: 104.61538461538461%'>work(1)</a> <a href='/blog/categories/writedown' style='font-size: 104.61538461538461%'>writedown(1)</a> </span>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/12/20/derivative-class/">Derivative Class</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/12/18/dparsf-quick-pack/">DPARSF Quick Pack</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/12/17/cpac-derivative-inputs/">CPAC Derivative Inputs</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/12/13/week-50-friday/">Week 50 - Friday</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/12/10/installing-connectir/">Installing Connectir</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/czarrar">@czarrar</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'czarrar',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>My Pinboard</h1>
  <ul id="pinboard_linkroll">Fetching linkroll&#8230;</ul>
  <p><a href="http://pinboard.in/u:czarrar">My Pinboard Bookmarks &raquo;</a></p>
</section>
<script type="text/javascript">
  var linkroll = 'pinboard_linkroll'; //id target for pinboard list
  var pinboard_user = "czarrar"; //id target for pinboard list
  var pinboard_count = 3; //id target for pinboard list
  (function(){
    var pinboardInit = document.createElement('script');
    pinboardInit.type = 'text/javascript';
    pinboardInit.async = true;
    pinboardInit.src = '/javascripts/pinboard.js';
    document.getElementsByTagName('head')[0].appendChild(pinboardInit);
  })();
</script>

<!--
    Calendar aside/plugin for octopress blogging framework.
    Copyright (C) 2012  Neeraj Kumar ( neerajpkumar@gmail.com, neerajkumar@outlook.com)

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
&#8211;>
<style>
	.highlighted-calendar-day
	{
		color : #CCC;
		font-weight : bold;
	}
	
	.calendar-header-day{
		font-weight : bold;
		color : #AAA;
		font-size : 14px;
	}
	
	.highlighted-calendar-day a
	{
		
	}
	
	.prev-link
	{
		float:left;
	}
	
	.next-link
	{
		float: right;
	}
	.calendar-day
	{
		color : #888;
		font-weight : 12px;
	}
	
	.calendar-table
	{
		width : 100%;
		
	}
	
	.calendar-table td
	{
		border-right : dotted 1px lightgrey;
		text-align : center;
	}
	
	.calendar-table td:last-child
	{
		border-right : none;
	}
	
	.calendar-table th
	{
		background-color : lightgrey;
		text-align : center;
	}
	.prevCalendarLink img
	{	
		
		width : 20px;
		height : 20px;
		border: 0px;
		float: left;
		
	}
	
	.nextCalendarLink img
	{
		
		width : 20px;
		height: 20px;
		border: 0px;
		float: right;
		
	}
</style>
<script type="text/javascript" src="/javascripts/calendar.js"></script>
<section id="calendarDiv">
	<h1>Calendar</h1>
	<span style="display:block" id="calendarSpan"></span>
	<div>
		<a href="#" class="previousMonth show"/><a href="#" class="nextMonth hide"/>
	</div>
</section>
<script type="text/javascript">
  
monthCalendar = function(id,year,month)
{
  var highlightArray = new Array();
  var hightlightLinks = new Array();
  
  highlightArray.push('12/20/2013');
  hightlightLinks.push('/blog/2013/12/20/derivative-class/');
  
  highlightArray.push('12/18/2013');
  hightlightLinks.push('/blog/2013/12/18/dparsf-quick-pack/');
  
  highlightArray.push('12/17/2013');
  hightlightLinks.push('/blog/2013/12/17/cpac-derivative-inputs/');
  
  highlightArray.push('12/13/2013');
  hightlightLinks.push('/blog/2013/12/13/week-50-friday/');
  
  highlightArray.push('12/10/2013');
  hightlightLinks.push('/blog/2013/12/10/installing-connectir/');
  		
  var cal = new Calendar(month,year,highlightArray,hightlightLinks);
  cal.generateHTML(id);
  var element = document.getElementById(id);
  element.innerHTML = cal.getHTML();
}
	
loadCalendar = function(){
  var now = new Date();
  var month = now.getMonth();
  var year = now.getFullYear();
  monthCalendar('calendarDiv',year,month);
}
	
	if(Array.prototype.indexOf == undefined)
	{
		 Array.prototype.indexOf = function (searchElement /*, fromIndex */ ) {
			"use strict";
			if (this == null) {
				throw new TypeError();
			}
			var t = Object(this);
			var len = t.length >>> 0;
			if (len === 0) {
				return -1;
			}
			var n = 0;
			if (arguments.length > 0) {
				n = Number(arguments[1]);
				if (n != n) { // shortcut for verifying if it's NaN
					n = 0;
				} else if (n != 0 && n != Infinity && n != -Infinity) {
					n = (n > 0 || -1) * Math.floor(Math.abs(n));
				}
			}
			if (n >= len) {
				return -1;
			}
			var k = n >= 0 ? n : Math.max(len - Math.abs(n), 0);
			for (; k < len; k++) {
				if (k in t && t[k] === searchElement) {
					return k;
				}
			}
			return -1;
		}
	}
$(document).ready(function(){
  loadCalendar();
});
</script>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Zarrar Shehzad -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
